{
  "schema_type": "adr",
  "id": "ADR-0037_Single-Command-Development-Environment",
  "title": "Single-Command Development Environment Setup",
  "status": "accepted",
  "date": "2025-12-28",
  "review_date": "2026-06-28",
  "deciders": "Mycahya Eggleston",
  "scope": "core",
  "provenance": [
    {
      "at": "2025-12-28",
      "by": "Mycahya Eggleston",
      "note": "Initial draft to establish frictionless development environment setup"
    }
  ],
  "context": "For a solo developer frequently context-switching between projects or returning after breaks, development environment setup friction is a significant productivity drain. Every minute spent debugging dependency issues, port conflicts, or missing configuration is a minute not spent on features. The ideal state is: clone repository, run one command, entire stack is running. This requires: deterministic dependency management, automated service orchestration, health checks to confirm readiness, and cross-platform support (Windows primary, macOS/Linux secondary).",
  "decision_primary": "Development environment MUST be launchable with a single command. ./start.ps1 (Windows) or ./start.sh (Unix) starts the entire stack: backend services, frontend dev servers, and documentation site. All Python dependencies are managed via uv (faster than pip, lockfile-based). Docker Compose provides full-stack option for isolation. Health checks confirm all services are ready before the script returns. The script is idempotent (safe to run multiple times).",
  "decision_details": {
    "approach": "Single entry point script orchestrates all services; uv for Python deps; Docker Compose for isolation",
    "constraints": [
      "Single command MUST start entire development stack",
      "Script MUST be idempotent (running twice doesn't break anything)",
      "Script MUST perform health checks and report service status",
      "All Python dependencies MUST be in pyproject.toml with uv.lock",
      "Docker Compose MUST be available as alternative (docker compose up)",
      "Cross-platform: Windows (primary), macOS/Linux (secondary)",
      "Script MUST fail fast with clear error messages on missing prerequisites"
    ],
    "start_script_behavior": {
      "windows": {
        "file": "start.ps1",
        "steps": [
          "1. Check prerequisites (Python 3.11+, uv, Node.js 18+)",
          "2. Create/activate virtual environment via uv",
          "3. Install Python dependencies (uv sync)",
          "4. Install frontend dependencies (npm install in each frontend/)",
          "5. Start gateway server (background)",
          "6. Start frontend dev servers (background)",
          "7. Start MkDocs server (background, optional)",
          "8. Run health checks on all endpoints",
          "9. Print service URLs and status"
        ]
      },
      "unix": {
        "file": "start.sh",
        "steps": "Same as Windows, using bash equivalents"
      }
    },
    "dependency_management": {
      "python": {
        "tool": "uv (https://github.com/astral-sh/uv)",
        "files": ["pyproject.toml", "uv.lock"],
        "rationale": "10-100x faster than pip; deterministic lockfile; cross-platform"
      },
      "javascript": {
        "tool": "npm",
        "files": ["package.json", "package-lock.json"],
        "location": "Each frontend/ directory"
      }
    },
    "docker_compose": {
      "file": "docker-compose.yml",
      "services": {
        "gateway": "FastAPI gateway on port 8000",
        "dat_frontend": "DAT React frontend on port 3001",
        "sov_frontend": "SOV React frontend on port 3002",
        "pptx_frontend": "PPTX React frontend on port 3003",
        "homepage": "Homepage React frontend on port 3000",
        "docs": "MkDocs server on port 8080"
      },
      "usage": "docker compose up --build",
      "rationale": "Full isolation; consistent across machines; CI/CD compatible"
    },
    "health_checks": {
      "gateway": "GET /health → 200",
      "frontends": "GET / → 200 (Vite dev server)",
      "docs": "GET / → 200 (MkDocs)",
      "timeout": "30 seconds per service",
      "retry": "5 attempts with 2-second backoff"
    },
    "implementation_specs": []
  },
  "consequences": [
    "✅ POSITIVE: Zero-friction onboarding (clone → start → working)",
    "✅ POSITIVE: Consistent environment across sessions",
    "✅ POSITIVE: Health checks catch startup issues immediately",
    "✅ POSITIVE: Docker option provides full isolation when needed",
    "✅ POSITIVE: uv is significantly faster than pip for dependency installation",
    "✅ POSITIVE: Idempotent script is safe to run repeatedly",
    "❌ NEGATIVE: Initial script development effort",
    "❌ NEGATIVE: uv is relatively new tool (mitigated: actively maintained, Astral backing)",
    "❌ NEGATIVE: Docker adds resource overhead (mitigated: optional, not required)",
    "⚠️ NEUTRAL: Multiple frontend dev servers use multiple ports"
  ],
  "alternatives_considered": [
    {
      "name": "Manual Setup (README instructions)",
      "pros": "No script maintenance, flexible",
      "cons": "Error-prone, time-consuming, inconsistent",
      "rejected_reason": "Solo-dev needs speed; manual setup is productivity drain"
    },
    {
      "name": "Makefile-Based Setup",
      "pros": "Unix standard, simple syntax",
      "cons": "Poor Windows support, limited error handling",
      "rejected_reason": "Windows is primary platform; PowerShell has better Windows integration"
    },
    {
      "name": "Docker-Only (No Local Dev)",
      "pros": "Maximum isolation, consistent",
      "cons": "Slower iteration, resource heavy, harder debugging",
      "rejected_reason": "Local dev is faster for iteration; Docker is optional escape hatch"
    },
    {
      "name": "pip + requirements.txt",
      "pros": "Standard, widely understood",
      "cons": "Slow, no lockfile by default, dependency resolution issues",
      "rejected_reason": "uv is faster and has better dependency resolution"
    }
  ],
  "tradeoffs": "We trade some script complexity for zero-friction startup. uv dependency adds a tool to install, but speed gains are worth it. Docker option adds complexity but provides isolation when needed.",
  "rollout_plan": [
    "1. Migrate from pip to uv (update pyproject.toml, generate uv.lock)",
    "2. Update start.ps1 to use uv sync",
    "3. Update start.sh to use uv sync",
    "4. Add health check logic to start scripts",
    "5. Create docker-compose.yml with all services",
    "6. Add Dockerfiles for each service",
    "7. Test on clean Windows and macOS machines",
    "8. Update README with single-command instructions"
  ],
  "rollback_plan": "If uv proves problematic: (1) Replace uv sync with pip install -r requirements.txt, (2) Generate requirements.txt from pyproject.toml. If Docker proves too heavy: (3) Remove docker-compose.yml, keep local-only setup. Incremental rollback possible.",
  "metrics_to_watch": [
    "Time from clone to running stack (should be < 5 minutes)",
    "Start script success rate (should be > 95%)",
    "Dependency installation time (uv vs pip comparison)"
  ],
  "guardrails": [
    {
      "id": "devenv-single-command",
      "rule": "./start.ps1 or ./start.sh MUST start entire development stack",
      "enforcement": "CI runs start script on clean environment",
      "scope": "core"
    },
    {
      "id": "devenv-health-checks",
      "rule": "Start script MUST verify all services are healthy before returning",
      "enforcement": "Script includes health check logic; fails if services unhealthy",
      "scope": "core"
    },
    {
      "id": "devenv-idempotent",
      "rule": "Start script MUST be idempotent (safe to run multiple times)",
      "enforcement": "Script handles already-running services gracefully",
      "scope": "core"
    },
    {
      "id": "devenv-uv-lockfile",
      "rule": "Python dependencies MUST be locked via uv.lock",
      "enforcement": "CI fails if uv.lock out of sync with pyproject.toml",
      "scope": "core"
    }
  ],
  "cross_cutting_guardrails": [
    "ADR-0012: Cross-platform support required"
  ],
  "references": [
    "uv: https://github.com/astral-sh/uv",
    "Docker Compose: https://docs.docker.com/compose/",
    "12-Factor App - Dev/Prod Parity: https://12factor.net/dev-prod-parity",
    "start.ps1",
    "start.sh",
    "docker-compose.yml"
  ],
  "tags": [
    "developer-experience",
    "devenv",
    "docker",
    "uv",
    "automation",
    "cross-platform",
    "solo-dev"
  ],
  "affected_components": [
    "start.ps1",
    "start.sh",
    "setup.ps1",
    "setup.sh",
    "pyproject.toml",
    "docker-compose.yml (new)",
    "Dockerfile (new, per service)",
    "README.md"
  ]
}
