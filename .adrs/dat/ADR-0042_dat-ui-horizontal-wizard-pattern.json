{
  "schema_type": "adr",
  "id": "ADR-0042_dat-ui-horizontal-wizard-pattern",
  "title": "DAT UI Horizontal Wizard Pattern for 8-Stage Pipeline",
  "status": "accepted",
  "date": "2025-12-28",
  "review_date": "2026-06-28",
  "deciders": "Mycahya Eggleston",
  "scope": "subsystem:DAT",
  "provenance": [
    {
      "at": "2025-12-28",
      "by": "Mycahya Eggleston",
      "note": "Initial decision for DAT frontend wizard UI pattern"
    }
  ],
  "context": "DAT's 8-stage pipeline (Discovery → Selection → Context → Table Availability → Table Selection → Preview → Parse → Export) requires a clear, guided UI that helps users progress through stages while maintaining visibility of their current position and stage states (locked/unlocked). The UI must communicate FSM state, gating rules, and provide intuitive navigation. Modern wizard UI patterns (research-backed) show horizontal steppers are most effective for 5-8 step workflows.",
  "decision_primary": "DAT frontend implements a horizontal wizard stepper pattern with collapsible stage panels. The stepper displays all 8 stages across the top with clear state indicators (pending, active, completed, locked, error). Each stage expands to show its content panel when active. Optional stages (Context, Preview) are visually distinguished but integrated into the flow.",
  "decision_details": {
    "approach": "Horizontal stepper with expandable stage panels, built using shadcn/ui Stepper and Collapsible components.",
    "ui_elements": {
      "stepper_bar": {
        "position": "top",
        "layout": "horizontal",
        "shows": [
          "stage_name",
          "stage_number",
          "state_indicator",
          "lock_icon"
        ],
        "interactive": true,
        "click_behavior": "Navigate to unlocked/completed stages only"
      },
      "stage_indicators": {
        "pending": {
          "icon": "circle-outline",
          "color": "gray",
          "label": "Not started"
        },
        "active": {
          "icon": "circle-dot",
          "color": "blue",
          "label": "In progress"
        },
        "completed": {
          "icon": "check-circle",
          "color": "green",
          "label": "Completed"
        },
        "locked": {
          "icon": "lock",
          "color": "green",
          "label": "Locked"
        },
        "error": {
          "icon": "alert-circle",
          "color": "red",
          "label": "Error"
        },
        "optional": {
          "badge": "Optional",
          "style": "dashed-border"
        }
      },
      "stage_panel": {
        "position": "below stepper",
        "behavior": "expands when stage is active",
        "contains": [
          "stage-specific content",
          "action buttons"
        ]
      },
      "navigation_buttons": {
        "back": "← Previous (enabled when previous stage exists)",
        "next": "Next → (enabled when current stage can be locked)",
        "skip": "Skip (enabled for optional stages only)",
        "lock": "Lock Stage (locks current stage)",
        "unlock": "Unlock (available for locked stages, triggers cascade)"
      },
      "progress_indicator": {
        "type": "combined",
        "shows": [
          "completion_percentage",
          "current_stage_name",
          "estimated_time"
        ]
      }
    },
    "stage_visibility": {
      "discovery": "hidden (implicit, runs automatically)",
      "selection": "visible, first user-interactive stage",
      "context": "visible, marked optional, can be skipped",
      "table_availability": "visible, auto-runs after selection lock",
      "table_selection": "visible, user selects tables",
      "preview": "visible, marked optional, can be skipped",
      "parse": "visible, shows progress during execution",
      "export": "visible, terminal stage with 'Pipe To' button"
    },
    "constraints": [
      "Stepper MUST show all 8 stages (minus hidden Discovery)",
      "Optional stages MUST be visually distinguished with 'Optional' badge",
      "Locked stages MUST show lock icon and prevent editing",
      "Gating rules MUST be communicated via disabled states and tooltips",
      "Stage navigation MUST respect FSM forward gating (ADR-0007)",
      "Unlock cascade MUST show confirmation dialog listing affected stages"
    ],
    "implementation_specs": [
      "SPEC-0029_dat-table-availability",
      "shadcn/ui Stepper component",
      "shadcn/ui Collapsible component"
    ]
  },
  "consequences": [
    "Users have clear visibility of all stages at once",
    "Current position and progress are always visible",
    "Optional stages are discoverable but skippable",
    "Lock/unlock state is immediately apparent",
    "Horizontal layout may be cramped on narrow screens (< 768px)",
    "Stage names must be concise to fit in stepper"
  ],
  "alternatives_considered": [
    {
      "name": "Vertical Stepper (Accordion)",
      "pros": "More space for stage content, works better on mobile",
      "cons": "Loses overview of all stages, harder to see progress",
      "rejected_reason": "8 stages benefit from horizontal overview visibility"
    },
    {
      "name": "Tab-based Navigation",
      "pros": "Familiar pattern, easy to jump between stages",
      "cons": "Doesn't communicate sequential flow or gating rules",
      "rejected_reason": "DAT requires guided sequential workflow with gating"
    },
    {
      "name": "Single Page Scrolling",
      "pros": "All content visible, no navigation needed",
      "cons": "Overwhelming for 8 stages, hard to manage state",
      "rejected_reason": "Too much cognitive load, doesn't match FSM model"
    }
  ],
  "tradeoffs": "We accept potential cramping on narrow screens for the benefit of full stage visibility. We accept concise stage naming constraints for horizontal fit.",
  "guardrails": [
    {
      "rule": "Stage Visibility: All 7 user-interactive stages MUST be visible in stepper",
      "enforcement": "UI component renders all stages from FSM stage graph config",
      "scope": "subsystem:DAT",
      "id": "dat-ui-stage-visibility"
    },
    {
      "rule": "Gating Communication: Disabled stages MUST show tooltip explaining why",
      "enforcement": "Stepper component includes tooltip with gating reason",
      "scope": "subsystem:DAT",
      "id": "dat-ui-gating-tooltip"
    },
    {
      "rule": "Unlock Confirmation: Unlock action MUST show cascade confirmation dialog",
      "enforcement": "Unlock button triggers dialog listing downstream stages to unlock",
      "scope": "subsystem:DAT",
      "id": "dat-ui-unlock-confirm"
    }
  ],
  "cross_cutting_guardrails": [
    "FSM Forward Gating: UI respects stage dependencies (see ADR-0007)",
    "Cascade Unlock: UI triggers cascade unlock via FSM (see ADR-0007#cascade-unlock)"
  ],
  "references": [
    "ADR-0003_stage-graph-configuration: 8-stage FSM this UI implements",
    "ADR-0004_optional-context-preview-stages: Optional stage behavior"
  ],
  "tags": [
    "dat",
    "ui",
    "wizard",
    "stepper",
    "frontend"
  ],
  "affected_components": [
    "apps/data_aggregator/frontend/src/components/DATWizard.tsx",
    "apps/data_aggregator/frontend/src/components/StageIndicator.tsx",
    "apps/data_aggregator/frontend/src/components/stages/"
  ]
}