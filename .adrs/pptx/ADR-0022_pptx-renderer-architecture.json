{
  "schema_type": "adr",
  "id": "ADR-0022_pptx-renderer-architecture",
  "title": "PPTX Generator Pluggable Renderer System for Shape Population",
  "status": "accepted",
  "date": "2024-12-27",
  "review_date": "2025-06-27",
  "deciders": "Mycahya Eggleston",
  "scope": "subsystem:PPTX",
  "provenance": [
    {
      "at": "2024-12-27",
      "by": "AI Analysis",
      "note": "Initial draft based on existing PPTX renderers/ implementation"
    },
    {
      "at": "2025-12-27",
      "by": "DevTools Editor",
      "note": "Updated via DevTools ADR Editor"
    }
  ],
  "context": "PPTX Generator must populate diverse shape types (text boxes, charts, tables, images) with data. Each shape type has unique rendering logic. The system must be extensible to support new shape types without modifying core generation code. The challenge is defining a clean interface that abstracts rendering details while providing sufficient context for each renderer.",
  "decision_primary": "PPTX Generator uses a pluggable renderer system with a common interface. Each shape category (text, chart, table, image) has a dedicated renderer class implementing BaseRenderer. Renderers are registered in a RendererRegistry and selected based on shape category from the shape name. Renderers receive shape reference, data context, and domain config. Failed renders log errors but do not abort generation (graceful degradation).",
  "decision_details": {
    "approach": "Strategy pattern with registry. BaseRenderer defines render(shape, data, config) interface. Concrete renderers (TextRenderer, ChartRenderer, etc.) implement shape-specific logic. RendererRegistry maps categories to renderer instances. Generation engine iterates shapes and dispatches to appropriate renderer.",
    "constraints": [
      "All renderers MUST implement BaseRenderer interface",
      "Renderers MUST NOT modify template structure (only fill placeholders)",
      "Renderer selection is based on shape category from naming convention",
      "Failed renders MUST log error and continue (graceful degradation)",
      "Renderers MUST NOT raise exceptions that abort generation",
      "New shape categories can be added by implementing renderer + registration"
    ],
    "implementation_specs": [
      "SPEC-0023_PPTX-Renderer-Interface-Spec"
    ]
  },
  "consequences": [
    "Shape rendering is extensible without core code changes",
    "Clear separation of concerns (each renderer focuses on one shape type)",
    "Graceful degradation (one failed shape doesn't break entire report)",
    "Testing is simplified (renderers can be tested in isolation)",
    "Complexity: renderer registration adds indirection",
    "Risk: renderer bugs may produce incorrect output (mitigated by validation step)"
  ],
  "alternatives_considered": [
    {
      "name": "Monolithic Render Function",
      "pros": "Simple, all logic in one place",
      "cons": "Hard to extend, violates single responsibility",
      "rejected_reason": "Not maintainable as shape types grow"
    },
    {
      "name": "Shape Type Detection at Runtime",
      "pros": "No naming convention required",
      "cons": "Ambiguous (text box vs. title), less reliable",
      "rejected_reason": "Naming convention provides explicit intent"
    },
    {
      "name": "Abort on First Render Failure",
      "pros": "Fail-fast, clear error",
      "cons": "One bad shape blocks entire report",
      "rejected_reason": "Graceful degradation provides better UX"
    }
  ],
  "tradeoffs": "We trade strict fail-fast behavior for graceful degradation. Registry pattern adds indirection but enables extensibility. Renderer isolation simplifies testing but requires coordination for shared data context.",
  "guardrails": [
    {
      "rule": "All renderers MUST implement BaseRenderer interface",
      "enforcement": "Type checking via abstract base class; CI tests verify interface compliance",
      "scope": "subsystem:PPTX",
      "id": "pptx-renderer-interface-compliance"
    },
    {
      "rule": "Renderers MUST NOT raise exceptions that abort generation",
      "enforcement": "Generation engine wraps render calls in try/except; logs errors and continues",
      "scope": "subsystem:PPTX",
      "id": "pptx-renderer-graceful-degradation"
    }
  ],
  "cross_cutting_guardrails": [
    "ADR-0045: Unified Rendering Engine - PPTX renderers SHOULD consume RenderSpec contracts from shared/contracts/core/rendering.py",
    "ADR-0045: Contract Discipline - Renderer interfaces defined as Pydantic models"
  ],
  "superseded_by": null,
  "related_adrs": [
    "ADR-0028_Unified-Rendering-Engine"
  ],
  "migration_notes": "PPTX renderers will be refactored to become thin adapters over the unified rendering engine. The existing BaseRenderer interface remains but implementations will delegate chart/table generation to shared/rendering/ engine. Shape population (inserting into PPTX) remains PPTX-specific.",
  "references": [
    "apps/pptx_generator/backend/renderers/",
    "shared/contracts/core/rendering.py",
    "shared/rendering/"
  ],
  "tags": [
    "pptx",
    "renderer",
    "strategy-pattern",
    "extensibility"
  ],
  "affected_components": [
    "apps/pptx_generator/backend/renderers/base.py",
    "apps/pptx_generator/backend/renderers/text_renderer.py",
    "apps/pptx_generator/backend/renderers/chart_renderer.py",
    "apps/pptx_generator/backend/renderers/table_renderer.py",
    "apps/pptx_generator/backend/services/generation_service.py"
  ]
}