{
  "schema_type": "adr",
  "id": "ADR-0019_PPTX-Guided-Workflow",
  "title": "PPTX Generator 7-Step Guided Workflow with Forward Gating",
  "status": "accepted",
  "date": "2024-12-27",
  "review_date": "2025-06-27",
  "deciders": "Mycahya Eggleston",
  "scope": "subsystem:PPTX",
  "provenance": [
    {
      "at": "2024-12-27",
      "by": "AI Analysis",
      "note": "Initial draft based on existing PPTX Generator implementation"
    },
    {
      "at": "2024-12-27",
      "by": "Mycahya Eggleston",
      "note": "Refactored as tool-specific extension of core ADR-0001_Guided-Workflow-FSM-Orchestration"
    },
    {
      "at": "2025-12-27",
      "by": "DevTools Editor",
      "note": "Updated via DevTools ADR Editor"
    }
  ],
  "context": "PPTX Generator transforms raw data into completed presentations through a multi-step process. This ADR defines PPTX's specific stage graph configuration that plugs into the core FSM orchestration pattern (ADR-0001). PPTX uses the 'simple_linear' state model because steps are lightweight (no heavy artifacts) and users benefit from straightforward progression. The cascade policy is 'reset_validation' - modifying earlier steps resets validation status of dependent steps without deleting user inputs.",
  "decision_primary": "PPTX implements the core Hybrid FSM pattern (ADR-0001) with a 7-step pipeline using the 'simple_linear' state model. Steps: (1) Upload Template, (2) Configure Environment, (3) Upload Data, (4) Map Context, (5) Map Metrics, (6) Validate, (7) Generate. Steps 1-3 are strictly sequential. Steps 4-5 may be completed in any order after Step 3. Step 6 requires Steps 1-5 complete. Step 7 requires Step 6 to pass ('Four Green Bars'). Cascade policy is 'reset_validation' - changes to earlier steps reset downstream validation status.",
  "decision_details": {
    "approach": "Extends core FSM orchestrator with PPTX-specific StageGraphConfig. Uses 'simple_linear' state model with 'reset_validation' cascade policy.",
    "stage_graph": {
      "stages": [
        {
          "id": "upload_template",
          "name": "Upload Template",
          "step": 1,
          "optional": false
        },
        {
          "id": "configure_env",
          "name": "Configure Environment",
          "step": 2,
          "optional": false
        },
        {
          "id": "upload_data",
          "name": "Upload Data",
          "step": 3,
          "optional": false
        },
        {
          "id": "map_context",
          "name": "Map Context",
          "step": 4,
          "optional": false
        },
        {
          "id": "map_metrics",
          "name": "Map Metrics",
          "step": 5,
          "optional": false
        },
        {
          "id": "validate",
          "name": "Validate",
          "step": 6,
          "optional": false
        },
        {
          "id": "generate",
          "name": "Generate",
          "step": 7,
          "optional": false,
          "terminal": true
        }
      ],
      "dependencies": [
        {
          "from": "upload_template",
          "to": "configure_env"
        },
        {
          "from": "configure_env",
          "to": "upload_data"
        },
        {
          "from": "upload_data",
          "to": "map_context"
        },
        {
          "from": "upload_data",
          "to": "map_metrics"
        },
        {
          "from": "map_context",
          "to": "validate"
        },
        {
          "from": "map_metrics",
          "to": "validate"
        },
        {
          "from": "validate",
          "to": "generate"
        }
      ],
      "cascade_policy": "reset_validation"
    },
    "state_model": "simple_linear",
    "constraints": [
      "Steps 1-3 are strictly sequential (cannot skip)",
      "Steps 4-5 may be completed in any order after Step 3",
      "Step 6 (Validate) requires Steps 1-5 complete",
      "Step 7 (Generate) requires Step 6 to pass with 'Four Green Bars'",
      "Modifying Step 1-3 resets Steps 4-6 validation status",
      "Modifying Step 4-5 resets Step 6 validation status",
      "Project state persists across sessions (users can resume)"
    ],
    "implementation_specs": [
      "SPEC-0021_PPTX-Workflow-FSM-Spec"
    ]
  },
  "consequences": [
    "Users are guided through the correct sequence",
    "Validation catches errors before generation (fast feedback)",
    "Step dependencies prevent invalid configurations",
    "Users can iterate on mappings without re-uploading data",
    "Complexity: frontend must track step states and update UI accordingly",
    "Risk: users may not understand why Generate is disabled (mitigated by clear messaging)"
  ],
  "alternatives_considered": [
    {
      "name": "Free-form Workflow (any order)",
      "pros": "Maximum flexibility, no gating logic needed",
      "cons": "Users may attempt generation with incomplete config, poor UX",
      "rejected_reason": "Leads to confusing error messages at generation time"
    },
    {
      "name": "Single-Page Wizard",
      "pros": "All steps visible at once, familiar pattern",
      "cons": "Overwhelming for complex mappings, doesn't scale",
      "rejected_reason": "PPTX mapping is too complex for single-page approach"
    },
    {
      "name": "Full DAT-Style FSM with Unlock Cascades",
      "pros": "Consistent with DAT tool, maximum control",
      "cons": "Overkill for PPTX's linear workflow, adds complexity",
      "rejected_reason": "PPTX doesn't need artifact preservation on unlock; simpler model suffices"
    }
  ],
  "tradeoffs": "We trade maximum flexibility for guided user experience. Step gating adds frontend/backend coordination but prevents user confusion. Reset-on-change ensures consistency but may frustrate users who make minor edits.",
  "guardrails": [
    {
      "rule": "Generate button MUST be disabled until Step 6 passes with 'Four Green Bars'",
      "enforcement": "Frontend disables button; backend rejects POST /generation if validation incomplete",
      "scope": "subsystem:PPTX",
      "id": "pptx-generate-requires-validation"
    },
    {
      "rule": "Modifying Steps 1-3 MUST reset validation status of Steps 4-6",
      "enforcement": "Backend clears validation flags on template/env/data changes",
      "scope": "subsystem:PPTX",
      "id": "pptx-reset-on-prerequisite-change"
    }
  ],
  "cross_cutting_guardrails": [
    "Core FSM Forward Gating (see ADR-0001#core-fsm-forward-gating)",
    "Core FSM State Persistence (see ADR-0001#core-fsm-state-persistence)"
  ],
  "references": [
    "ADR-0001_Guided-Workflow-FSM-Orchestration: Core FSM pattern this extends",
    "docs/pptx-generator/index.md"
  ],
  "tags": [
    "pptx",
    "workflow",
    "fsm",
    "guided-ux"
  ],
  "affected_components": [
    "apps/pptx_generator/backend/api/projects.py",
    "apps/pptx_generator/backend/services/",
    "apps/pptx_generator/frontend/src/components/WorkflowStepper.tsx"
  ]
}
