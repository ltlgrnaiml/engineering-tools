{
  "schema_type": "adr",
  "id": "ADR-0025_sov-visualization-contracts",
  "title": "SOV Analyzer Visualization Data Contracts for Frontend Rendering",
  "status": "accepted",
  "date": "2024-12-27",
  "review_date": "2025-06-27",
  "deciders": "Mycahya Eggleston",
  "scope": "subsystem:SOV",
  "provenance": [
    {
      "at": "2024-12-27",
      "by": "AI Analysis",
      "note": "Initial draft based on SOV visualization requirements"
    },
    {
      "at": "2025-12-27",
      "by": "DevTools Editor",
      "note": "Updated via DevTools ADR Editor"
    }
  ],
  "context": "SOV Analyzer produces statistical results that must be visualized in the frontend and potentially rendered in PPTX reports. Rather than having the frontend compute chart data from raw ANOVA results, the backend should produce visualization-ready contracts. These contracts are Pydantic models containing pre-computed data arrays and chart configuration. The challenge is defining contracts that are flexible enough for diverse chart types while remaining strongly typed.",
  "decision_primary": "SOV Analyzer outputs visualization-ready Pydantic contracts for each chart type: VarianceBarChartData, ParetoChartData, MainEffectsPlotData, InteractionPlotData. Each contract contains data arrays (labels, values, colors) and chart metadata (title, axis labels, significance thresholds). Frontend renders directly from contracts without additional computation. Contracts are included in DataSet manifest for downstream tools.",
  "decision_details": {
    "approach": "Typed Pydantic contracts per visualization type. Backend computes all chart data. Contracts include both data and presentation metadata. Contracts serialized to JSON in DataSet manifest.",
    "constraints": [
      "All visualization contracts MUST be Pydantic models in shared/contracts/sov/",
      "Contracts MUST include data arrays (not scalar summaries)",
      "Contracts MUST include chart metadata (title, axis labels)",
      "Frontend MUST render from contracts without additional computation",
      "Contracts MUST be serializable to JSON for manifest storage",
      "Chart types: bar, pareto, line, heatmap"
    ],
    "implementation_specs": [
      "SPEC-0027_SOV-Visualization-Contracts-Spec",
      "SPEC-0007"
    ]
  },
  "consequences": [
    "Frontend rendering is simplified (no statistical computation)",
    "Strong typing catches contract mismatches at compile time",
    "PPTX Generator can consume same contracts for chart rendering",
    "Backend owns chart data computation (single source of truth)",
    "Risk: Contract changes require frontend/backend coordination (mitigated by versioning)",
    "Risk: Large data arrays may bloat manifests (mitigated by reasonable limits)"
  ],
  "alternatives_considered": [
    {
      "name": "Frontend Computes Chart Data",
      "pros": "Flexible, can adjust visualization without backend changes",
      "cons": "Duplicates statistical logic, inconsistent results possible",
      "rejected_reason": "Backend should own statistical computation for consistency"
    },
    {
      "name": "Generic Chart Contract (One Size Fits All)",
      "pros": "Simpler, single contract for all charts",
      "cons": "Loses type safety, awkward for different chart types",
      "rejected_reason": "Specific contracts provide better type safety and clarity"
    },
    {
      "name": "Raw ANOVA Results Only",
      "pros": "Minimal backend changes",
      "cons": "Frontend must understand ANOVA output format",
      "rejected_reason": "Visualization contracts reduce frontend complexity"
    }
  ],
  "tradeoffs": "We trade flexibility (frontend chart customization) for consistency (backend owns chart data). Multiple contract types add schema complexity but provide type safety. Contracts in manifest add storage but enable cross-tool reuse.",
  "guardrails": [
    {
      "rule": "All visualization contracts MUST be Pydantic models in shared/contracts/",
      "enforcement": "Code review; CI import checks",
      "scope": "subsystem:SOV",
      "id": "sov-viz-contracts-pydantic"
    },
    {
      "rule": "Frontend MUST render from contracts without additional statistical computation",
      "enforcement": "Code review; frontend tests verify no stats imports",
      "scope": "subsystem:SOV",
      "id": "sov-frontend-no-stats"
    }
  ],
  "cross_cutting_guardrails": [
    "Contract Discipline: Contracts in shared/contracts/ are Tier 0 (see ADR-0045)",
    "ADR-0045: Unified Rendering Engine - SOV visualization contracts SHOULD extend RenderSpec hierarchy from shared/contracts/core/rendering.py"
  ],
  "superseded_by": null,
  "related_adrs": [
    "ADR-0028_Unified-Rendering-Engine",
    "ADR-0021_PPTX-Renderer-Architecture"
  ],
  "migration_notes": "SOV visualization contracts (BoxPlotConfig, InteractionPlotConfig, etc.) will be refactored to extend base ChartSpec from the unified rendering engine. This enables direct consumption by PPTX Generator without contract translation. Existing SOV-specific fields remain but inherit common styling and output format contracts from the shared hierarchy.",
  "references": [
    "ADR-0009_Type-Safety-Contract-Discipline",
    "ADR-0028_Unified-Rendering-Engine",
    "shared/contracts/",
    "shared/contracts/core/rendering.py",
    "ADR-0027",
    "ADR-0024"
  ],
  "tags": [
    "sov",
    "visualization",
    "contracts",
    "charts"
  ],
  "affected_components": [
    "shared/contracts/sov/",
    "apps/sov_analyzer/backend/src/sov_analyzer/analysis/",
    "apps/sov_analyzer/frontend/src/components/charts/"
  ]
}