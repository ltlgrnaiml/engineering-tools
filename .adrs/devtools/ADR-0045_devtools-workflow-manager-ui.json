{
  "schema_type": "adr",
  "id": "ADR-0045_devtools-workflow-manager-ui",
  "title": "DevTools Workflow Manager UI Architecture",
  "status": "active",
  "date": "2025-12-30",
  "review_date": "2026-06-30",
  "deciders": "Mycahya Eggleston",
  "scope": "devtools",
  "source_discussion": "DISC-001_DevTools-AI-Workflow-Integration",
  "provenance": [
    {
      "at": "2025-12-30",
      "by": "AI-Assisted Design Session",
      "note": "Initial draft from DISC-001 discussion (7 sessions)"
    },
    {
      "at": "2025-12-30",
      "by": "AI-Assisted Design Session",
      "note": "Added tiered_plan_granularity section (L1/L2/L3) for cost-effective AI execution"
    }
  ],
  "context": {
    "description": "The DevTools panel (ADR-0045) currently provides an ADR Reader/Editor. With the introduction of ADR-0045 (AI Development Workflow), there is now a 6-tier artifact hierarchy (Discussion, ADR, SPEC, Contract, Plan, Fragment) that needs unified management. Developers need to visualize relationships between artifacts, navigate between linked documents, and orchestrate the workflow from a single UI.",
    "problem": "Need to extend DevTools to: (1) manage all workflow artifact types (not just ADRs), (2) visualize artifact relationships as an interactive graph, (3) guide users through workflow creation with a wizard/stepper, (4) integrate with AI chat sessions for content generation while using UI for structure and tracking.",
    "constraints": [
      "Must extend existing DevTools architecture (ADR-0045)",
      "Must use existing tech stack: React, TypeScript, TailwindCSS, Lucide icons",
      "Must follow existing API pattern: /api/devtools/*",
      "Artifacts stored as files (not database) per existing architecture",
      "Must not break existing ADR Reader/Editor functionality"
    ]
  },
  "decision": {
    "summary": "Implement a Workflow Manager utility within DevTools featuring a sidebar with tabbed artifact navigation, an interactive 2D/3D graph visualization, a reader/editor panel, and a workflow wizard with progress stepper.",
    "details": {
      "ui_layout": {
        "pattern": "Sidebar + Main Panel (Map + Reader)",
        "sidebar": {
          "description": "Tabbed file tree with artifact type tabs",
          "tabs": [
            "ADRs",
            "SPECs",
            "Discussions",
            "Plans",
            "Contracts"
          ],
          "features": [
            "Search bar",
            "Status indicators",
            "Folder organization"
          ]
        },
        "main_panel": {
          "viewer_mode": {
            "top": "Interactive artifact graph (2D/3D toggle)",
            "bottom": "Reader view with edit button",
            "divider": "Resizable split pane"
          },
          "editor_mode": {
            "behavior": "Slides in from right, replaces viewer",
            "components": [
              "Back button",
              "Form fields",
              "Save/Cancel"
            ]
          }
        },
        "header": {
          "components": [
            "New Workflow dropdown button",
            "Active artifact selector",
            "Search icon",
            "Settings icon"
          ]
        }
      },
      "visualization": {
        "library": "react-force-graph",
        "rationale": "Identical API across 2D, 3D, VR, AR packages; d3-force physics; low dependency footprint; excellent interactive features",
        "alternatives_rejected": [
          {
            "name": "Reagraph",
            "reason": "Good but no VR/AR future-proofing"
          },
          {
            "name": "Sigma.js",
            "reason": "Overkill for our graph size"
          },
          {
            "name": "Cytoscape.js",
            "reason": "Heavier, more complex API"
          }
        ],
        "features": {
          "2d_3d_toggle": {
            "implementation": "Lazy-load 3D component to minimize bundle size",
            "shared_props": "Identical props work for both variants"
          },
          "interactivity": {
            "click_node": "Focus file, update reader, re-center map",
            "hover_node": "Show tooltip card with artifact summary",
            "drag_node": "Rearrange layout (session persistence)",
            "double_click": "Open editor for that file"
          },
          "node_colors_by_tier": {
            "T0_Discussion": "#3B82F6",
            "T1_ADR": "#22C55E",
            "T2_SPEC": "#EAB308",
            "T3_Contract": "#A855F7",
            "T4_Plan": "#EF4444",
            "T5_Fragment": "#6B7280"
          },
          "edge_types": {
            "implements": "Solid arrow (SPEC implements ADR)",
            "references": "Dashed line (cross-reference)",
            "creates": "Dotted arrow (Discussion creates ADR)",
            "tracked_by": "Solid line (artifact tracked by Plan)"
          }
        }
      },
      "workflow_wizard": {
        "entry_points": [
          {
            "type": "New Feature",
            "starts_at": "Discussion"
          },
          {
            "type": "Architecture Change",
            "starts_at": "Discussion"
          },
          {
            "type": "Bug Fix",
            "starts_at": "Plan"
          },
          {
            "type": "Enhancement",
            "starts_at": "SPEC"
          },
          {
            "type": "New Data Structure",
            "starts_at": "Contract (manual)"
          }
        ],
        "stepper": {
          "description": "Progress bar showing workflow stages",
          "appears_when": "User is actively stepping through workflow creation",
          "stages": [
            "Discussion",
            "ADR",
            "SPEC",
            "Contract",
            "Plan"
          ]
        }
      },
      "automation_architecture": {
        "principle": "UI orchestrates structure, AI generates content",
        "ui_responsibilities": [
          "Create artifacts from templates",
          "Edit structured fields (forms)",
          "Track progress and status",
          "Visualize relationships (graph)",
          "Generate handoff prompts for AI"
        ],
        "ai_responsibilities": [
          "Fill in rich content",
          "Generate next artifact from previous",
          "Execute code changes (Contracts, Fragments)",
          "Refine unstructured content"
        ],
        "shared_ssot": "Files on disk (both UI and AI read/write same files)"
      },
      "tiered_plan_granularity": {
        "rationale": "Enable cost-effective AI execution by allowing plans to be generated at different detail levels. Users with budget can use powerful models with minimal detail; users optimizing cost can generate detailed step-by-step instructions for cheaper models.",
        "levels": {
          "L1_STANDARD": {
            "description": "Baseline detail with context (mid-tier models, $$)",
            "task_fields": [
              "description",
              "context[]",
              "verification_command"
            ],
            "when_to_use": "Standard work, have budget for capable model"
          },
          "L2_ENHANCED": {
            "description": "Added hints, patterns, and file references (smaller models, $)",
            "task_fields": [
              "+ hints[]",
              "+ references[]"
            ],
            "when_to_use": "Large scope, want guardrails against common mistakes"
          },
          "L3_PROCEDURAL": {
            "description": "Full step-by-step instructions with code snippets (cheapest models, $)",
            "task_fields": [
              "+ steps[] with code_snippets and checkpoints"
            ],
            "when_to_use": "Massive project, budget-constrained, using smaller model"
          }
        },
        "schema_location": "shared/contracts/plan_schema.py",
        "key_models": [
          "GranularityLevel",
          "TaskStep",
          "Task.context",
          "Task.hints",
          "Task.steps"
        ],
        "expandable": "Plans can start at L1 and have specific tasks expanded to L2/L3 on demand"
      },
      "power_user_features": {
        "command_palette": {
          "shortcut": "Cmd+K / Ctrl+K",
          "actions": [
            "Navigate to artifact",
            "Create new",
            "Toggle 2D/3D",
            "Start workflow"
          ]
        },
        "keyboard_shortcuts": {
          "Tab/Shift+Tab": "Move through sidebar",
          "Arrow keys": "Navigate graph nodes",
          "Enter": "Select focused node",
          "E": "Open editor",
          "Escape": "Close editor / back",
          "2/3": "Toggle 2D/3D mode"
        },
        "activity_feed": "Recent changes across all artifacts"
      }
    }
  },
  "consequences": {
    "positive": [
      "Unified management of all workflow artifacts in one UI",
      "Visual understanding of artifact relationships via graph",
      "Guided workflow creation reduces onboarding friction",
      "Power users get keyboard shortcuts and command palette",
      "2D/3D toggle provides both focused work and presentation modes",
      "File-based SSOT enables seamless AIâ†”UI integration"
    ],
    "negative": [
      "Additional bundle size from react-force-graph (~200KB for 3D, lazy-loaded)",
      "More complex UI state management across viewer/editor/wizard modes",
      "Requires backend API extensions for artifact scanning"
    ],
    "risks": [
      {
        "risk": "Graph performance with many artifacts",
        "mitigation": "Ego-centric view by default, collapse distant nodes"
      },
      {
        "risk": "User confusion between UI editing and AI chat editing",
        "mitigation": "Clear handoff prompts, activity feed shows all changes"
      }
    ]
  },
  "alternatives_considered": [
    {
      "name": "Tabbed Artifact Types (Option A)",
      "description": "Separate tabs for ADRs, SPECs, Discussions, Plans",
      "pros": [
        "Simple",
        "Matches existing ADR-only pattern"
      ],
      "cons": [
        "More clicks to switch",
        "Harder to see relationships"
      ],
      "rejected_reason": "Doesn't support cross-artifact visualization"
    },
    {
      "name": "Unified View with Filter (Option B)",
      "description": "Single list with type filter dropdown",
      "pros": [
        "All artifacts in one place"
      ],
      "cons": [
        "May feel cluttered",
        "No visual hierarchy"
      ],
      "rejected_reason": "Sidebar tabs provide better organization"
    },
    {
      "name": "2D Only Visualization",
      "description": "Skip 3D support entirely",
      "pros": [
        "Simpler implementation",
        "Smaller bundle"
      ],
      "cons": [
        "Less impressive for demos",
        "No future VR/AR path"
      ],
      "rejected_reason": "3D adds WOW factor with minimal complexity due to identical API"
    }
  ],
  "guardrails": [
    {
      "id": "workflow-manager-preserve-adr-functionality",
      "rule": "Existing ADR Reader/Editor functionality MUST remain intact",
      "enforcement": "Regression tests for ADR CRUD operations",
      "scope": "devtools"
    },
    {
      "id": "workflow-manager-file-ssot",
      "rule": "All artifact data MUST be stored as files, not database",
      "enforcement": "No database models for workflow artifacts",
      "scope": "devtools"
    },
    {
      "id": "workflow-manager-destructive-actions",
      "rule": "Delete operations MUST show confirmation and create backups",
      "enforcement": "Backend moves to .backup/ directory",
      "scope": "devtools"
    },
    {
      "id": "workflow-manager-lazy-load-3d",
      "rule": "3D graph component MUST be lazy-loaded",
      "enforcement": "React.lazy() with Suspense fallback",
      "scope": "devtools"
    }
  ],
  "cross_cutting_guardrails": [
    "Path Safety: All file paths must be relative (ADR-0045#path-safety)",
    "API Naming: Endpoints at /api/devtools/* (ADR-0045)"
  ],
  "implementation_phases": {
    "phase_1_mvp": [
      "Backend API for artifact scanning (all types)",
      "Sidebar with tabbed file tree",
      "Graph visualization (2D first, then 3D toggle)",
      "Reader component for all artifact types",
      "Editor slide-in panel",
      "Command palette (Cmd+K)",
      "Activity feed",
      "Empty states with guidance"
    ],
    "phase_1_5": [
      "Saved views/filters",
      "Export graph as image",
      "Workflow wizard with stepper"
    ],
    "phase_2_separate": [
      "Config Manager (DISC-002)",
      "Inline comments/annotations"
    ]
  },
  "references": [
    "DISC-001_DevTools-AI-Workflow-Integration",
    "ADR-0027_DevTools-Page-Architecture",
    "ADR-0041_AI-Development-Workflow",
    "https://github.com/vasturiano/react-force-graph"
  ],
  "tags": [
    "devtools",
    "workflow",
    "visualization",
    "graph",
    "react-force-graph",
    "ai-assisted-development"
  ],
  "affected_components": [
    "apps/homepage/frontend/src/pages/DevToolsPage.tsx",
    "apps/homepage/frontend/src/components/ (new workflow components)",
    "gateway/services/devtools_service.py",
    "gateway/routes/devtools.py"
  ],
  "resulting_specs": [
    {
      "id": "SPEC-0003",
      "title": "DevTools Workflow Manager",
      "status": "draft"
    }
  ]
}