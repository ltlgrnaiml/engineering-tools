{
  "id": "SPEC-0034_devtools-workflow-manager",
  "title": "DevTools Workflow Manager Specification",
  "version": "2025.12.01",
  "status": "draft",
  "created_date": "2025-12-30",
  "updated_date": "2025-12-30",
  "implements_adr": [
    "ADR-0045",
    "ADR-0028"
  ],
  "source_discussion": "DISC-001_DevTools-AI-Workflow-Integration",
  "tier_0_contracts": [
    {
      "module": "shared.contracts.devtools.workflow",
      "classes": ["ArtifactType", "GraphNode", "GraphEdge", "ArtifactSummary", "ArtifactListResponse"]
    },
    {
      "module": "shared.contracts.plan_schema",
      "classes": ["PlanSchema", "GranularityLevel", "TaskStep", "Milestone", "TaskEvidence"]
    },
    {
      "module": "shared.contracts.spec_schema",
      "classes": ["SPECSchema", "Requirement", "APIContract"]
    }
  ],
  "overview": {
    "purpose": "Define the DevTools Workflow Manager UI for managing AI Development Workflow artifacts (Discussions, ADRs, SPECs, Plans, Contracts) with interactive graph visualization and guided workflow creation.",
    "scope": "Extends existing DevTools page (ADR-0028) with unified artifact management, 2D/3D graph visualization, and workflow wizard functionality.",
    "out_of_scope": [
      "Config/Profile management (deferred to DISC-002/Phase 2)",
      "Inline comments/annotations (Phase 2)",
      "Real-time collaboration features"
    ]
  },
  "requirements": {
    "functional": [
      {
        "id": "SPEC-0034-F01",
        "category": "Artifact Discovery",
        "description": "Backend API for scanning all workflow artifact types",
        "acceptance_criteria": [
          "GET /api/devtools/artifacts returns all artifacts across types",
          "Supports filtering by type: discussion, adr, spec, plan, contract",
          "Supports filtering by status: draft, active, resolved, deprecated",
          "Returns artifact metadata: id, title, type, status, created_date, updated_date",
          "Extracts cross-references from artifact content for graph edges",
          "Response time < 200ms for up to 500 artifacts"
        ],
        "api_endpoint": {
          "method": "GET",
          "path": "/api/devtools/artifacts",
          "query_params": [
            "type",
            "status",
            "search"
          ],
          "response_model": "ArtifactListResponse"
        }
      },
      {
        "id": "SPEC-0034-F02",
        "category": "Artifact Discovery",
        "description": "Backend API for reading individual artifact content",
        "acceptance_criteria": [
          "GET /api/devtools/artifacts/{type}/{id} returns full artifact content",
          "Supports all artifact types: discussion, adr, spec, plan, contract",
          "Returns parsed JSON for structured artifacts (ADR, SPEC)",
          "Returns raw markdown for unstructured artifacts (Discussion, Plan)",
          "Returns Python source for contracts",
          "Includes extracted references for graph building"
        ],
        "api_endpoint": {
          "method": "GET",
          "path": "/api/devtools/artifacts/{artifact_type}/{artifact_id}",
          "response_model": "ArtifactDetailResponse"
        }
      },
      {
        "id": "SPEC-0034-F03",
        "category": "Artifact Discovery",
        "description": "Backend API for artifact graph data",
        "acceptance_criteria": [
          "GET /api/devtools/artifacts/graph returns nodes and edges",
          "Nodes include: id, type, title, status, tier",
          "Edges include: source, target, relationship_type",
          "Relationship types: implements, references, creates, tracked_by",
          "Supports ego-centric filtering: GET /api/devtools/artifacts/graph?focus={id}&depth={n}",
          "Response optimized for react-force-graph consumption"
        ],
        "api_endpoint": {
          "method": "GET",
          "path": "/api/devtools/artifacts/graph",
          "query_params": [
            "focus",
            "depth",
            "types"
          ],
          "response_model": "ArtifactGraphResponse"
        }
      },
      {
        "id": "SPEC-0034-F04",
        "category": "Artifact CRUD",
        "description": "Backend API for creating new artifacts",
        "acceptance_criteria": [
          "POST /api/devtools/artifacts creates artifact from template",
          "Generates next available ID for artifact type",
          "Validates required fields per artifact type schema",
          "Creates file in correct directory per artifact type",
          "Returns created artifact with full path"
        ],
        "api_endpoint": {
          "method": "POST",
          "path": "/api/devtools/artifacts",
          "request_model": "ArtifactCreateRequest",
          "response_model": "ArtifactCreateResponse"
        }
      },
      {
        "id": "SPEC-0034-F05",
        "category": "Artifact CRUD",
        "description": "Backend API for updating existing artifacts",
        "acceptance_criteria": [
          "PUT /api/devtools/artifacts/{type}/{id} updates artifact content",
          "Creates backup before overwrite (move to .backup/ directory)",
          "Validates content against artifact type schema",
          "Updates provenance/history field with timestamp",
          "Returns updated artifact content"
        ],
        "api_endpoint": {
          "method": "PUT",
          "path": "/api/devtools/artifacts/{artifact_type}/{artifact_id}",
          "request_model": "ArtifactUpdateRequest",
          "response_model": "ArtifactUpdateResponse"
        }
      },
      {
        "id": "SPEC-0034-F06",
        "category": "Artifact CRUD",
        "description": "Backend API for deleting artifacts (soft delete)",
        "acceptance_criteria": [
          "DELETE /api/devtools/artifacts/{type}/{id} moves to .backup/",
          "Does NOT permanently delete files",
          "Returns confirmation with backup path",
          "Supports restore via separate endpoint (future)"
        ],
        "api_endpoint": {
          "method": "DELETE",
          "path": "/api/devtools/artifacts/{artifact_type}/{artifact_id}",
          "response_model": "ArtifactDeleteResponse"
        }
      },
      {
        "id": "SPEC-0034-F07",
        "category": "UI Layout",
        "description": "Sidebar with tabbed artifact navigation",
        "acceptance_criteria": [
          "Sidebar occupies left 280px of viewport (collapsible)",
          "Tab bar with icons for each artifact type: Discussions, ADRs, SPECs, Plans, Contracts",
          "Each tab shows scrollable file list for that type",
          "File list items show: title, status badge, last modified date",
          "Search input filters current tab's file list",
          "Clicking file item selects it and updates main panel",
          "Selected item has visual highlight",
          "Supports keyboard navigation (Tab, Arrow keys, Enter)"
        ],
        "component": "WorkflowSidebar"
      },
      {
        "id": "SPEC-0034-F08",
        "category": "UI Layout",
        "description": "Main panel with graph and reader (viewer mode)",
        "acceptance_criteria": [
          "Main panel occupies remaining viewport width",
          "Resizable split pane: graph (top) and reader (bottom)",
          "Default split: 40% graph, 60% reader",
          "Split position persists in localStorage",
          "Graph can be collapsed (reader takes full height)",
          "Reader can be collapsed (graph takes full height)"
        ],
        "component": "WorkflowMainPanel"
      },
      {
        "id": "SPEC-0034-F09",
        "category": "Graph Visualization",
        "description": "Interactive 2D/3D artifact graph",
        "acceptance_criteria": [
          "Uses react-force-graph-2d as default visualization",
          "Toggle button switches to react-force-graph-3d (lazy-loaded)",
          "3D mode loads via React.lazy() with Suspense fallback",
          "Nodes colored by tier (see ADR-0045 color scheme)",
          "Node size proportional to connection count",
          "Edges styled by relationship type (solid, dashed, dotted)",
          "Edge arrows indicate direction",
          "Graph centers on selected artifact",
          "Smooth zoom and pan controls",
          "Performance: renders 200+ nodes at 60fps"
        ],
        "component": "ArtifactGraph",
        "dependencies": [
          "react-force-graph-2d",
          "react-force-graph-3d",
          "three"
        ]
      },
      {
        "id": "SPEC-0034-F10",
        "category": "Graph Visualization",
        "description": "Graph node interactivity",
        "acceptance_criteria": [
          "Hover node: show tooltip with artifact summary (title, type, status)",
          "Click node: select artifact, update reader, re-center graph",
          "Double-click node: open editor for that artifact",
          "Drag node: reposition (layout persists in session)",
          "Right-click node: context menu (View, Edit, Copy Link)"
        ],
        "component": "ArtifactGraph"
      },
      {
        "id": "SPEC-0034-F11",
        "category": "Reader",
        "description": "Artifact reader/viewer component",
        "acceptance_criteria": [
          "Renders formatted view of selected artifact",
          "ADRs: renders JSON fields as structured sections",
          "SPECs: renders JSON with collapsible requirement sections",
          "Discussions: renders markdown with syntax highlighting",
          "Plans: renders JSON with milestone/task progress indicators and granularity badge",
          "Contracts: renders Python with syntax highlighting",
          "Edit button in header opens editor panel",
          "Copy button copies artifact content to clipboard",
          "Link button copies shareable URL to clipboard"
        ],
        "component": "ArtifactReader"
      },
      {
        "id": "SPEC-0034-F12",
        "category": "Editor",
        "description": "Slide-in editor panel",
        "acceptance_criteria": [
          "Editor slides in from right, replaces viewer",
          "Animation duration: 200ms ease-in-out",
          "Back button returns to viewer mode",
          "Form-based editing for structured artifacts (ADR, SPEC)",
          "Monaco editor for unstructured artifacts (Discussion, Plan, Contract)",
          "Save button validates and persists changes",
          "Cancel button discards changes with confirmation if dirty",
          "Keyboard shortcuts: Ctrl+S (save), Escape (cancel)"
        ],
        "component": "ArtifactEditor"
      },
      {
        "id": "SPEC-0034-F13",
        "category": "Header",
        "description": "Workflow header action bar",
        "acceptance_criteria": [
          "Header spans full width above sidebar and main panel",
          "New Workflow dropdown button with options: New Feature, Architecture Change, Bug Fix, Enhancement, New Data Structure",
          "New Workflow dropdown also has: New Discussion, New ADR, New SPEC, New Plan",
          "Active artifact breadcrumb shows current selection",
          "Search icon opens global search modal",
          "Settings icon opens preferences panel"
        ],
        "component": "WorkflowHeader"
      },
      {
        "id": "SPEC-0034-F14",
        "category": "Workflow Wizard",
        "description": "Workflow stepper for guided creation",
        "acceptance_criteria": [
          "Stepper bar appears below header when workflow is active",
          "Shows stages: Discussion → ADR → SPEC → Contract → Plan",
          "Current stage highlighted, completed stages checked",
          "Click on completed stage to jump back and view",
          "Next button advances to next stage with prompt generation",
          "Cancel button exits wizard with confirmation",
          "Stepper persists active workflow state in localStorage"
        ],
        "component": "WorkflowStepper"
      },
      {
        "id": "SPEC-0034-F15",
        "category": "Command Palette",
        "description": "Keyboard-driven command palette",
        "acceptance_criteria": [
          "Cmd+K (Mac) / Ctrl+K (Windows) opens command palette",
          "Search input filters available commands",
          "Commands include: Navigate to artifact, Create new, Toggle 2D/3D, Start workflow",
          "Recent items shown at top",
          "Arrow keys navigate, Enter selects, Escape closes",
          "Fuzzy search matching for artifact names"
        ],
        "component": "CommandPalette"
      },
      {
        "id": "SPEC-0034-F16",
        "category": "Activity Feed",
        "description": "Recent activity sidebar section",
        "acceptance_criteria": [
          "Shows recent changes across all artifact types",
          "Each item shows: artifact name, change type (created/updated), timestamp",
          "Click item navigates to that artifact",
          "Limited to 20 most recent items",
          "Refreshes on artifact save/create"
        ],
        "component": "ActivityFeed"
      },
      {
        "id": "SPEC-0034-F17",
        "category": "Empty States",
        "description": "Helpful empty states for new users",
        "acceptance_criteria": [
          "Empty sidebar tab shows: 'No {type}s yet. Create your first →'",
          "Empty main panel shows: 'Select an artifact to view'",
          "Empty graph shows: 'No artifacts to visualize'",
          "All empty states have action buttons to create first artifact"
        ],
        "component": "EmptyState"
      },
      {
        "id": "SPEC-0034-F18",
        "category": "Export",
        "description": "Export graph as image",
        "acceptance_criteria": [
          "Export button in graph toolbar",
          "Exports current view as PNG",
          "Includes filename with timestamp",
          "Works in both 2D and 3D modes"
        ],
        "component": "ArtifactGraph"
      },
      {
        "id": "SPEC-0034-F19",
        "category": "Plan Granularity",
        "description": "Tiered plan granularity for cost-effective AI execution",
        "implements_adr": "ADR-0045#tiered_plan_granularity",
        "acceptance_criteria": [
          "Plans support three granularity levels: L1 (Standard), L2 (Enhanced), L3 (Procedural)",
          "L1 tasks include: description, context[], verification_command",
          "L2 tasks add: hints[], references[]",
          "L3 tasks add: steps[] with code_snippets and checkpoints",
          "Plan reader displays granularity badge (L1/L2/L3)",
          "Plan editor allows expanding individual tasks to higher granularity level",
          "API supports generating L2/L3 detail from L1 task via AI",
          "Schema enforced via shared/contracts/plan_schema.py (GranularityLevel, TaskStep models)"
        ],
        "component": "PlanEditor",
        "api_endpoint": {
          "method": "POST",
          "path": "/api/devtools/plans/{plan_id}/tasks/{task_id}/expand",
          "query_params": [
            "target_level"
          ],
          "description": "Expand task to higher granularity level"
        }
      },
      {
        "id": "SPEC-0034-F20",
        "category": "Plan Granularity",
        "description": "Plan progress tracking with evidence capture",
        "acceptance_criteria": [
          "Each task tracks status: pending, in_progress, passed, failed, skipped",
          "Completed tasks store TaskEvidence: command run, output, timestamp, session_id",
          "Plan reader shows computed progress: percentage, completed/total tasks",
          "Milestone progress displayed in sidebar",
          "Progress persists in JSON plan file"
        ],
        "component": "PlanReader"
      }
    ],
    "non_functional": [
      {
        "id": "SPEC-0034-NF01",
        "category": "Performance",
        "description": "Fast initial load and responsive UI",
        "acceptance_criteria": [
          "Initial page load < 2 seconds",
          "Artifact list load < 200ms",
          "Graph render < 500ms for 200 nodes",
          "Editor open animation < 200ms",
          "No jank during graph interaction (60fps)"
        ]
      },
      {
        "id": "SPEC-0034-NF02",
        "category": "Accessibility",
        "description": "Keyboard navigation and screen reader support",
        "acceptance_criteria": [
          "All interactive elements focusable via Tab",
          "Focus indicators visible",
          "ARIA labels on buttons and sections",
          "Color contrast meets WCAG AA",
          "Graph nodes navigable via keyboard"
        ]
      },
      {
        "id": "SPEC-0034-NF03",
        "category": "Responsiveness",
        "description": "Adaptive layout for different screen sizes",
        "acceptance_criteria": [
          "Minimum supported width: 1024px",
          "Sidebar collapsible on smaller screens",
          "Graph maintains aspect ratio on resize",
          "Editor takes full width on narrow screens"
        ]
      },
      {
        "id": "SPEC-0034-NF04",
        "category": "Error Handling",
        "description": "Graceful error handling and recovery",
        "acceptance_criteria": [
          "API errors show toast notification with message",
          "Save failures retain editor state for retry",
          "Graph rendering errors show fallback UI",
          "Network offline shows banner with retry"
        ]
      },
      {
        "id": "SPEC-0034-NF05",
        "category": "Security",
        "description": "Safe file operations",
        "acceptance_criteria": [
          "All file paths validated (relative only, no traversal)",
          "Backup created before destructive operations",
          "No arbitrary file read/write outside allowed directories"
        ]
      }
    ]
  },
  "api_contracts": {
    "models": [
      {
        "name": "ArtifactType",
        "type": "enum",
        "values": [
          "discussion",
          "adr",
          "spec",
          "plan",
          "contract"
        ]
      },
      {
        "name": "ArtifactStatus",
        "type": "enum",
        "values": [
          "draft",
          "active",
          "resolved",
          "deprecated",
          "superseded"
        ]
      },
      {
        "name": "RelationshipType",
        "type": "enum",
        "values": [
          "implements",
          "references",
          "creates",
          "tracked_by"
        ]
      },
      {
        "name": "ArtifactSummary",
        "type": "model",
        "fields": [
          {
            "name": "id",
            "type": "str",
            "description": "Unique artifact identifier"
          },
          {
            "name": "type",
            "type": "ArtifactType",
            "description": "Artifact type"
          },
          {
            "name": "title",
            "type": "str",
            "description": "Human-readable title"
          },
          {
            "name": "status",
            "type": "ArtifactStatus",
            "description": "Current status"
          },
          {
            "name": "path",
            "type": "str",
            "description": "Relative file path"
          },
          {
            "name": "created_date",
            "type": "date",
            "description": "Creation date"
          },
          {
            "name": "updated_date",
            "type": "date",
            "description": "Last update date"
          }
        ]
      },
      {
        "name": "ArtifactListResponse",
        "type": "model",
        "fields": [
          {
            "name": "artifacts",
            "type": "list[ArtifactSummary]",
            "description": "List of artifacts"
          },
          {
            "name": "total",
            "type": "int",
            "description": "Total count"
          }
        ]
      },
      {
        "name": "ArtifactDetailResponse",
        "type": "model",
        "fields": [
          {
            "name": "artifact",
            "type": "ArtifactSummary",
            "description": "Artifact metadata"
          },
          {
            "name": "content",
            "type": "dict | str",
            "description": "Full artifact content"
          },
          {
            "name": "references",
            "type": "list[str]",
            "description": "Extracted reference IDs"
          }
        ]
      },
      {
        "name": "GraphNode",
        "type": "model",
        "fields": [
          {
            "name": "id",
            "type": "str",
            "description": "Node identifier"
          },
          {
            "name": "type",
            "type": "ArtifactType",
            "description": "Artifact type"
          },
          {
            "name": "title",
            "type": "str",
            "description": "Display label"
          },
          {
            "name": "status",
            "type": "ArtifactStatus",
            "description": "Status for styling"
          },
          {
            "name": "tier",
            "type": "int",
            "description": "Workflow tier (0-5)"
          }
        ]
      },
      {
        "name": "GraphEdge",
        "type": "model",
        "fields": [
          {
            "name": "source",
            "type": "str",
            "description": "Source node ID"
          },
          {
            "name": "target",
            "type": "str",
            "description": "Target node ID"
          },
          {
            "name": "relationship",
            "type": "RelationshipType",
            "description": "Edge type"
          }
        ]
      },
      {
        "name": "ArtifactGraphResponse",
        "type": "model",
        "fields": [
          {
            "name": "nodes",
            "type": "list[GraphNode]",
            "description": "Graph nodes"
          },
          {
            "name": "edges",
            "type": "list[GraphEdge]",
            "description": "Graph edges"
          }
        ]
      },
      {
        "name": "ArtifactCreateRequest",
        "type": "model",
        "fields": [
          {
            "name": "type",
            "type": "ArtifactType",
            "description": "Artifact type to create"
          },
          {
            "name": "title",
            "type": "str",
            "description": "Artifact title"
          },
          {
            "name": "initial_content",
            "type": "dict | None",
            "description": "Optional initial content"
          }
        ]
      },
      {
        "name": "ArtifactCreateResponse",
        "type": "model",
        "fields": [
          {
            "name": "artifact",
            "type": "ArtifactSummary",
            "description": "Created artifact"
          },
          {
            "name": "content",
            "type": "dict | str",
            "description": "Full content from template"
          }
        ]
      },
      {
        "name": "ArtifactUpdateRequest",
        "type": "model",
        "fields": [
          {
            "name": "content",
            "type": "dict | str",
            "description": "Updated content"
          }
        ]
      },
      {
        "name": "ArtifactUpdateResponse",
        "type": "model",
        "fields": [
          {
            "name": "artifact",
            "type": "ArtifactSummary",
            "description": "Updated artifact"
          },
          {
            "name": "backup_path",
            "type": "str",
            "description": "Path to backup file"
          }
        ]
      },
      {
        "name": "ArtifactDeleteResponse",
        "type": "model",
        "fields": [
          {
            "name": "success",
            "type": "bool",
            "description": "Deletion success"
          },
          {
            "name": "backup_path",
            "type": "str",
            "description": "Path to backup file"
          }
        ]
      }
    ],
    "endpoints": [
      {
        "method": "GET",
        "path": "/api/devtools/artifacts",
        "description": "List all artifacts with optional filtering",
        "query_params": [
          {
            "name": "type",
            "type": "ArtifactType | None",
            "description": "Filter by type"
          },
          {
            "name": "status",
            "type": "ArtifactStatus | None",
            "description": "Filter by status"
          },
          {
            "name": "search",
            "type": "str | None",
            "description": "Search in title"
          }
        ],
        "response": "ArtifactListResponse"
      },
      {
        "method": "GET",
        "path": "/api/devtools/artifacts/{artifact_type}/{artifact_id}",
        "description": "Get single artifact with full content",
        "response": "ArtifactDetailResponse"
      },
      {
        "method": "GET",
        "path": "/api/devtools/artifacts/graph",
        "description": "Get artifact relationship graph",
        "query_params": [
          {
            "name": "focus",
            "type": "str | None",
            "description": "Center on this artifact ID"
          },
          {
            "name": "depth",
            "type": "int",
            "description": "Max depth from focus (default: 3)"
          },
          {
            "name": "types",
            "type": "list[ArtifactType] | None",
            "description": "Include only these types"
          }
        ],
        "response": "ArtifactGraphResponse"
      },
      {
        "method": "POST",
        "path": "/api/devtools/artifacts",
        "description": "Create new artifact from template",
        "request": "ArtifactCreateRequest",
        "response": "ArtifactCreateResponse"
      },
      {
        "method": "PUT",
        "path": "/api/devtools/artifacts/{artifact_type}/{artifact_id}",
        "description": "Update existing artifact",
        "request": "ArtifactUpdateRequest",
        "response": "ArtifactUpdateResponse"
      },
      {
        "method": "DELETE",
        "path": "/api/devtools/artifacts/{artifact_type}/{artifact_id}",
        "description": "Soft-delete artifact (move to backup)",
        "response": "ArtifactDeleteResponse"
      },
      {
        "method": "GET",
        "path": "/api/devtools/artifacts/activity",
        "description": "Get recent artifact activity",
        "query_params": [
          {
            "name": "limit",
            "type": "int",
            "description": "Max items (default: 20)"
          }
        ],
        "response": "ActivityListResponse"
      }
    ]
  },
  "ui_components": {
    "hierarchy": [
      {
        "name": "WorkflowManagerPage",
        "description": "Top-level page component",
        "children": [
          "WorkflowHeader",
          "WorkflowStepper",
          "WorkflowLayout"
        ]
      },
      {
        "name": "WorkflowHeader",
        "description": "Action bar with workflow controls",
        "children": [
          "NewWorkflowDropdown",
          "ArtifactBreadcrumb",
          "SearchButton",
          "SettingsButton"
        ]
      },
      {
        "name": "WorkflowStepper",
        "description": "Progress stepper for active workflows",
        "children": [
          "StepIndicator"
        ]
      },
      {
        "name": "WorkflowLayout",
        "description": "Split layout container",
        "children": [
          "WorkflowSidebar",
          "WorkflowMainPanel"
        ]
      },
      {
        "name": "WorkflowSidebar",
        "description": "Left sidebar with artifact tabs",
        "children": [
          "SidebarTabs",
          "ArtifactList",
          "ActivityFeed"
        ]
      },
      {
        "name": "WorkflowMainPanel",
        "description": "Main content area",
        "children": [
          "ArtifactGraph",
          "ArtifactReader",
          "ArtifactEditor"
        ]
      },
      {
        "name": "ArtifactGraph",
        "description": "2D/3D force graph visualization",
        "children": [
          "GraphToolbar",
          "ForceGraph2D | ForceGraph3D"
        ]
      },
      {
        "name": "ArtifactReader",
        "description": "Formatted artifact viewer",
        "children": [
          "ReaderHeader",
          "ReaderContent"
        ]
      },
      {
        "name": "ArtifactEditor",
        "description": "Slide-in artifact editor",
        "children": [
          "EditorHeader",
          "EditorForm | MonacoEditor",
          "EditorActions"
        ]
      },
      {
        "name": "CommandPalette",
        "description": "Global command palette modal",
        "children": [
          "CommandSearch",
          "CommandList"
        ]
      },
      {
        "name": "EmptyState",
        "description": "Empty state placeholder with CTA",
        "children": []
      }
    ],
    "state_management": {
      "approach": "React Context + useReducer for global state, useState for local",
      "global_state": [
        "selectedArtifact: ArtifactSummary | null",
        "artifacts: Map<ArtifactType, ArtifactSummary[]>",
        "graphData: { nodes: GraphNode[], edges: GraphEdge[] }",
        "activeWorkflow: WorkflowState | null",
        "viewMode: 'viewer' | 'editor'",
        "graphMode: '2d' | '3d'",
        "sidebarCollapsed: boolean",
        "commandPaletteOpen: boolean"
      ],
      "persistence": [
        "localStorage: selectedArtifact, graphMode, sidebarCollapsed, splitPosition",
        "sessionStorage: activeWorkflow"
      ]
    }
  },
  "keyboard_shortcuts": [
    {
      "shortcut": "Cmd/Ctrl + K",
      "action": "Open command palette"
    },
    {
      "shortcut": "Cmd/Ctrl + S",
      "action": "Save (in editor)"
    },
    {
      "shortcut": "Escape",
      "action": "Close editor / command palette"
    },
    {
      "shortcut": "E",
      "action": "Open editor for selected artifact"
    },
    {
      "shortcut": "2",
      "action": "Switch to 2D graph"
    },
    {
      "shortcut": "3",
      "action": "Switch to 3D graph"
    },
    {
      "shortcut": "Tab",
      "action": "Navigate sidebar items"
    },
    {
      "shortcut": "Enter",
      "action": "Select focused item"
    },
    {
      "shortcut": "Arrow Up/Down",
      "action": "Navigate list items"
    }
  ],
  "design_tokens": {
    "colors": {
      "tier_0_discussion": "#3B82F6",
      "tier_1_adr": "#22C55E",
      "tier_2_spec": "#EAB308",
      "tier_3_contract": "#A855F7",
      "tier_4_plan": "#EF4444",
      "tier_5_fragment": "#6B7280",
      "status_draft": "#9CA3AF",
      "status_active": "#22C55E",
      "status_resolved": "#3B82F6",
      "status_deprecated": "#EF4444"
    },
    "edge_styles": {
      "implements": {
        "stroke": "solid",
        "arrow": true
      },
      "references": {
        "stroke": "dashed",
        "arrow": false
      },
      "creates": {
        "stroke": "dotted",
        "arrow": true
      },
      "tracked_by": {
        "stroke": "solid",
        "arrow": false
      }
    }
  },
  "test_requirements": {
    "unit_tests": [
      "test_artifact_list_api_returns_all_types",
      "test_artifact_list_api_filters_by_type",
      "test_artifact_list_api_filters_by_status",
      "test_artifact_detail_api_returns_content",
      "test_artifact_graph_api_returns_nodes_and_edges",
      "test_artifact_create_generates_next_id",
      "test_artifact_update_creates_backup",
      "test_artifact_delete_moves_to_backup",
      "test_graph_node_colors_by_tier",
      "test_graph_edge_styles_by_relationship"
    ],
    "integration_tests": [
      "test_sidebar_navigation_updates_reader",
      "test_graph_click_selects_artifact",
      "test_editor_save_persists_changes",
      "test_workflow_stepper_advances_stages",
      "test_command_palette_opens_on_shortcut"
    ],
    "e2e_tests": [
      "test_create_discussion_workflow",
      "test_navigate_artifact_graph",
      "test_edit_and_save_adr",
      "test_2d_3d_toggle"
    ]
  },
  "implementation_milestones": [
    {
      "id": "M1",
      "name": "Backend API Foundation",
      "tasks": [
        "Create workflow.py contract in shared/contracts/devtools/",
        "Implement artifact scanning service",
        "Add /api/devtools/artifacts endpoints",
        "Add /api/devtools/artifacts/graph endpoint",
        "Write unit tests for all endpoints"
      ],
      "acceptance_criteria": [
        "All API endpoints return valid responses",
        "Unit tests pass",
        "Response time < 200ms"
      ]
    },
    {
      "id": "M2",
      "name": "Sidebar Component",
      "tasks": [
        "Create WorkflowSidebar component",
        "Implement SidebarTabs with artifact type icons",
        "Implement ArtifactList with search filtering",
        "Add keyboard navigation",
        "Style with TailwindCSS"
      ],
      "acceptance_criteria": [
        "Tabs switch artifact lists",
        "Search filters results",
        "Keyboard navigation works"
      ]
    },
    {
      "id": "M3",
      "name": "Graph Visualization",
      "tasks": [
        "Install react-force-graph dependencies",
        "Create ArtifactGraph component (2D first)",
        "Implement node coloring by tier",
        "Implement edge styling by relationship",
        "Add hover tooltips",
        "Add click/double-click handlers",
        "Implement 2D/3D toggle with lazy loading"
      ],
      "acceptance_criteria": [
        "Graph renders with correct colors",
        "Interactions work (hover, click, drag)",
        "2D/3D toggle works with lazy loading"
      ]
    },
    {
      "id": "M4",
      "name": "Reader Component",
      "tasks": [
        "Create ArtifactReader component",
        "Implement JSON renderer for ADR/SPEC",
        "Implement Markdown renderer for Discussion/Plan",
        "Implement Python syntax highlighter for Contract",
        "Add Edit button linking to editor"
      ],
      "acceptance_criteria": [
        "All artifact types render correctly",
        "Edit button opens editor"
      ]
    },
    {
      "id": "M5",
      "name": "Editor Component",
      "tasks": [
        "Create ArtifactEditor component",
        "Implement slide-in animation",
        "Add form-based editing for structured types",
        "Integrate Monaco editor for unstructured types",
        "Implement save/cancel with validation",
        "Add dirty state confirmation"
      ],
      "acceptance_criteria": [
        "Editor slides in/out smoothly",
        "Save persists changes via API",
        "Validation errors shown"
      ]
    },
    {
      "id": "M6",
      "name": "Header & Command Palette",
      "tasks": [
        "Create WorkflowHeader component",
        "Implement NewWorkflowDropdown",
        "Create CommandPalette component",
        "Add Cmd+K keyboard shortcut listener",
        "Implement fuzzy search for artifacts"
      ],
      "acceptance_criteria": [
        "Dropdown creates new artifacts",
        "Command palette opens on shortcut",
        "Fuzzy search works"
      ]
    },
    {
      "id": "M7",
      "name": "Activity Feed & Empty States",
      "tasks": [
        "Create ActivityFeed component",
        "Implement activity tracking on CRUD operations",
        "Create EmptyState component variants",
        "Add CTA buttons to empty states"
      ],
      "acceptance_criteria": [
        "Activity feed shows recent changes",
        "Empty states guide users"
      ]
    },
    {
      "id": "M8",
      "name": "Workflow Stepper",
      "tasks": [
        "Create WorkflowStepper component",
        "Implement workflow state management",
        "Add stage progression logic",
        "Persist active workflow in sessionStorage",
        "Generate AI handoff prompts"
      ],
      "acceptance_criteria": [
        "Stepper shows progress",
        "Stage transitions work",
        "State persists across refresh"
      ]
    },
    {
      "id": "M9",
      "name": "Integration & Polish",
      "tasks": [
        "Wire all components together",
        "Add loading states and error handling",
        "Implement graph export as PNG",
        "Run accessibility audit and fix issues",
        "Performance optimization",
        "Write E2E tests"
      ],
      "acceptance_criteria": [
        "Full user flow works",
        "No accessibility violations",
        "E2E tests pass"
      ]
    }
  ],
  "dependencies": {
    "npm_packages": [
      {
        "name": "react-force-graph-2d",
        "version": "^1.44.0",
        "reason": "2D force graph"
      },
      {
        "name": "react-force-graph-3d",
        "version": "^1.24.0",
        "reason": "3D force graph (lazy)"
      },
      {
        "name": "three",
        "version": "^0.160.0",
        "reason": "Peer dependency for 3D"
      },
      {
        "name": "@monaco-editor/react",
        "version": "^4.6.0",
        "reason": "Code editor"
      },
      {
        "name": "react-markdown",
        "version": "^9.0.0",
        "reason": "Markdown rendering"
      },
      {
        "name": "react-syntax-highlighter",
        "version": "^15.5.0",
        "reason": "Code highlighting"
      }
    ],
    "existing_packages": [
      "react",
      "react-dom",
      "typescript",
      "tailwindcss",
      "lucide-react"
    ]
  },
  "references": [
    "DISC-001_DevTools-AI-Workflow-Integration",
    "ADR-0043_DevTools-Workflow-Manager-UI",
    "ADR-0027_DevTools-Page-Architecture",
    "SPEC-0030_DevTools-API",
    "https://github.com/vasturiano/react-force-graph"
  ]
}