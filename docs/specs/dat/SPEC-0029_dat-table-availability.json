{
  "schema_type": "spec",
  "id": "SPEC-0029_dat-table-availability",
  "title": "DAT Table Availability Detection Specification",
  "version": "0.1.0",
  "status": "draft",
  "date": "2025-12-27",
  "author": "Mycahya Eggleston",
  "implements_adr": [
    "ADR-0006_Table-Availability",
    "ADR-0008",
    "ADR-0027",
    "ADR-0042"
  ],
  "tier_0_contracts": [
    {
      "module": "shared.contracts.dat.table_status",
      "classes": [
        "TableAvailability",
        "TableAvailabilityStatus",
        "TableStatusReport",
        "TableHealth",
        "TableParseError"
      ]
    }
  ],
  "purpose": "Define how DAT detects and reports table availability status. This enables the frontend to show which tables are available, partially available, missing, or empty before parsing begins.",
  "scope": "subsystem:DAT",
  "requirements": [
    {
      "id": "REQ-TABLE-001",
      "description": "Table status MUST be one of defined statuses",
      "statuses": [
        "AVAILABLE",
        "PARTIAL",
        "MISSING",
        "EMPTY",
        "ERROR"
      ]
    },
    {
      "id": "REQ-TABLE-002",
      "description": "Status check MUST be fast (< 1 second per table)",
      "implementation": "Head-only reads, no full parsing"
    },
    {
      "id": "REQ-TABLE-003",
      "description": "Status report MUST include health metrics",
      "metrics": [
        "row_count_estimate",
        "column_count",
        "file_size_bytes",
        "last_modified"
      ]
    }
  ],
  "status_definitions": [
    {
      "status": "AVAILABLE",
      "description": "Table exists with expected schema"
    },
    {
      "status": "PARTIAL",
      "description": "Table exists but missing some expected columns"
    },
    {
      "status": "MISSING",
      "description": "Table file not found at expected location"
    },
    {
      "status": "EMPTY",
      "description": "Table file exists but contains no data rows"
    },
    {
      "status": "ERROR",
      "description": "Table cannot be read due to error"
    }
  ],
  "probe_strategy": {
    "steps": [
      "Check file existence",
      "Read file header only",
      "Validate column names against profile",
      "Estimate row count from file size",
      "Return TableAvailability with status and metrics"
    ],
    "timeout_ms": 1000,
    "parallel": true
  },
  "references": [
    "ADR-0006_Table-Availability: WHY we probe tables",
    "shared/contracts/dat/table_status.py: Tier-0 contracts"
  ]
}