{
  "schema_type": "spec",
  "id": "SPEC-0034",
  "title": "Simplified API Naming Convention Specification",
  "version": "2025.12.001",
  "status": "active",
  "implements": "ADR-0029",
  "date": "2025-12-28",
  "scope": "core",
  "summary": "Technical specification for simplified API endpoint naming without version prefixes. Pattern: /api/{tool}/{resource} for tool-specific, /api/{resource} for cross-tool. Version suffix (e.g., /runs-v2) added only on breaking changes.",
  "changelog": [
    {
      "version": "2025.12.001",
      "date": "2025-12-28",
      "change": "SIMPLIFIED: Removed /v1/ prefix from all routes per ADR-0029 solo-dev simplification"
    }
  ],
  "url_patterns": {
    "gateway_cross_tool_apis": {
      "base_pattern": "/api/{resource}",
      "note": "NO version prefix by default; suffix versioning on breaking changes only",
      "endpoints": {
        "datasets": {
          "list": "GET /api/datasets",
          "get": "GET /api/datasets/{dataset_id}",
          "preview": "GET /api/datasets/{dataset_id}/preview",
          "lineage": "GET /api/datasets/{dataset_id}/lineage"
        },
        "pipelines": {
          "list": "GET /api/pipelines",
          "get": "GET /api/pipelines/{pipeline_id}",
          "create": "POST /api/pipelines",
          "execute": "POST /api/pipelines/{pipeline_id}/execute",
          "cancel": "POST /api/pipelines/{pipeline_id}/cancel"
        },
        "devtools": {
          "adrs_list": "GET /api/devtools/adrs",
          "adr_get": "GET /api/devtools/adrs/{folder}/{filename}",
          "adr_create": "POST /api/devtools/adrs",
          "adr_update": "PUT /api/devtools/adrs/{folder}/{filename}"
        }
      }
    },
    "tool_specific_apis": {
      "dat": {
        "base_pattern": "/api/dat/{resource}",
        "router_config": "APIRouter() - no prefix needed",
        "gateway_mount": "app.mount('/api/dat', dat_app)",
        "endpoints": {
          "runs": {
            "list": "GET /api/dat/runs",
            "get": "GET /api/dat/runs/{run_id}",
            "create": "POST /api/dat/runs"
          },
          "stages": {
            "get_status": "GET /api/dat/runs/{run_id}/stages/{stage}",
            "lock": "POST /api/dat/runs/{run_id}/stages/{stage}/lock",
            "unlock": "POST /api/dat/runs/{run_id}/stages/{stage}/unlock",
            "scan": "POST /api/dat/runs/{run_id}/stages/selection/scan"
          },
          "export": {
            "create": "POST /api/dat/runs/{run_id}/export"
          },
          "profiles": {
            "list": "GET /api/dat/profiles"
          }
        }
      },
      "sov": {
        "base_pattern": "/api/sov/{resource}",
        "router_config": "APIRouter() - no prefix needed",
        "gateway_mount": "app.mount('/api/sov', sov_app)",
        "endpoints": {
          "analyses": {
            "list": "GET /api/sov/analyses",
            "get": "GET /api/sov/analyses/{analysis_id}",
            "create": "POST /api/sov/analyses",
            "run": "POST /api/sov/analyses/{analysis_id}/run",
            "export": "POST /api/sov/analyses/{analysis_id}/export"
          }
        }
      },
      "pptx": {
        "base_pattern": "/api/pptx/{resource}",
        "router_config": "APIRouter() - routes mounted directly",
        "gateway_mount": "app.mount('/api/pptx', pptx_app)",
        "endpoints": {
          "projects": {
            "list": "GET /api/pptx/projects",
            "get": "GET /api/pptx/projects/{project_id}",
            "create": "POST /api/pptx/projects",
            "from_dataset": "POST /api/pptx/projects/{project_id}/from-dataset",
            "generate": "POST /api/pptx/projects/{project_id}/generate",
            "render": "POST /api/pptx/projects/{project_id}/render"
          },
          "templates": {
            "list": "GET /api/pptx/templates",
            "get": "GET /api/pptx/templates/{template_id}"
          },
          "data": {
            "upload": "POST /api/pptx/data/upload"
          },
          "preview": {
            "get": "GET /api/pptx/preview/{project_id}"
          }
        }
      }
    },
    "health_endpoints": {
      "note": "Health endpoints remain simple per ADR-0029",
      "endpoints": {
        "gateway_health": "GET /health",
        "dat_health": "GET /api/dat/health",
        "sov_health": "GET /api/sov/health",
        "pptx_health": "GET /api/pptx/health"
      }
    },
    "suffix_versioning": {
      "note": "Used ONLY when breaking change requires parallel implementation",
      "trigger": "Breaking API change where old behavior must be preserved",
      "pattern": "/{resource}-v2 alongside /{resource}",
      "example": {
        "original": "/api/dat/runs",
        "new_version": "/api/dat/runs-v2",
        "deprecation": "Original marked deprecated in OpenAPI; removed after migration"
      }
    }
  },
  "frontend_api_constants": {
    "note": "Frontend applications use simplified paths (no /v1/)",
    "dat_frontend": {
      "base": "/api/dat",
      "examples": [
        "fetch(`/api/dat/runs`)",
        "fetch(`/api/dat/runs/${runId}`)",
        "fetch(`/api/dat/runs/${runId}/stages/${stage}/lock`)"
      ]
    },
    "sov_frontend": {
      "base": "/api/sov",
      "examples": [
        "fetch(`/api/sov/analyses`)",
        "fetch(`/api/sov/analyses/${analysisId}`)"
      ]
    },
    "homepage_frontend": {
      "datasets_base": "/api/datasets",
      "pipelines_base": "/api/pipelines",
      "examples": [
        "fetch(`/api/datasets`)",
        "fetch(`/api/pipelines/${pipelineId}/execute`)"
      ]
    }
  },
  "implementation_checklist": {
    "backend": [
      "DAT: router = APIRouter() - routes use /runs, /profiles directly",
      "SOV: router = APIRouter() - routes use /analyses directly",
      "PPTX: Routers mounted directly under /api/pptx/",
      "Gateway: Cross-tool routes at /api/datasets, /api/pipelines (no /v1/)"
    ],
    "frontend": [
      "DAT frontend: All fetch calls use /api/dat/... pattern",
      "SOV frontend: All fetch calls use /api/sov/... pattern",
      "Homepage: Dataset calls use /api/datasets/...",
      "Homepage: Pipeline calls use /api/pipelines/..."
    ],
    "tests": [
      "All test API calls must use simplified paths (no /v1/)",
      "Integration tests verify actual route accessibility"
    ],
    "migration_from_v1": [
      "Remove prefix='/v1' from all APIRouter() calls",
      "Update frontend fetch calls to remove /v1/",
      "Update test URLs to remove /v1/",
      "Verify OpenAPI spec reflects simplified paths"
    ]
  },
  "validation_commands": {
    "verify_dat_routes": "curl http://localhost:8000/api/dat/runs",
    "verify_sov_routes": "curl http://localhost:8000/api/sov/analyses",
    "verify_pptx_routes": "curl http://localhost:8000/api/pptx/projects",
    "verify_datasets": "curl http://localhost:8000/api/datasets",
    "verify_pipelines": "curl http://localhost:8000/api/pipelines",
    "verify_health": "curl http://localhost:8000/health"
  },
  "common_mistakes": [
    {
      "mistake": "Adding /v1/ prefix (old pattern)",
      "wrong": "fetch('/api/dat/v1/runs')",
      "correct": "fetch('/api/dat/runs')"
    },
    {
      "mistake": "Using path versioning instead of suffix versioning",
      "wrong": "/api/dat/v2/runs (path versioning)",
      "correct": "/api/dat/runs-v2 (suffix versioning for breaking changes)"
    },
    {
      "mistake": "Adding version to cross-tool APIs",
      "wrong": "fetch('/api/v1/datasets')",
      "correct": "fetch('/api/datasets')"
    }
  ],
  "tags": ["api", "naming", "simplified", "solo-dev", "url-patterns"]
}
