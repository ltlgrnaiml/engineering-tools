{
  "schema_type": "spec",
  "id": "SPEC-0031_Unified-Rendering-Contracts",
  "title": "Unified Rendering Engine Contracts Specification",
  "version": "0.1.0",
  "status": "draft",
  "date": "2025-12-27",
  "author": "Mycahya Eggleston",
  "implements_adr": [
    "ADR-0028_Unified-Rendering-Engine"
  ],
  "tier_0_contracts": [
    {
      "module": "shared.contracts.core.rendering",
      "classes": [
        "RenderSpec",
        "ChartSpec",
        "TableSpec",
        "TextSpec",
        "ImageSpec",
        "CompositeSpec",
        "RenderStyle",
        "DataSeries",
        "DataPoint",
        "HeatmapData",
        "TableData",
        "OutputTarget",
        "OutputFormat",
        "RenderResult",
        "RenderRequest",
        "BatchRenderRequest"
      ],
      "enums": [
        "ChartType",
        "ColorPalette",
        "RenderState"
      ]
    }
  ],
  "purpose": "Define the Pydantic contracts for the Unified Rendering Engine. These contracts specify WHAT to render (not HOW) and are consumed by all tools (DAT, SOV, PPTX). The contracts are renderer-agnostic and support multiple output targets.",
  "scope": "core",
  "requirements": [
    {
      "id": "REQ-RENDER-001",
      "description": "All render specifications MUST extend RenderSpec base class",
      "rationale": "Per ADR-0028: Unified contract hierarchy",
      "implementation": "ChartSpec, TableSpec, TextSpec, ImageSpec all inherit from RenderSpec"
    },
    {
      "id": "REQ-RENDER-002",
      "description": "RenderSpec contracts MUST NOT contain renderer-specific logic",
      "examples_forbidden": ["matplotlib axes objects", "PPTX shape references", "HTML elements"],
      "enforcement": "Code review; type checking"
    },
    {
      "id": "REQ-RENDER-003",
      "description": "All visualization styling MUST use RenderStyle contract",
      "rationale": "Per ADR-0028: Centralized styling as single source of truth",
      "components": ["ColorPalette", "FontConfig", "GridConfig", "AxisConfig", "LegendConfig"]
    },
    {
      "id": "REQ-RENDER-004",
      "description": "Chart data MUST use DataSeries for time-series/categorical data",
      "fields": ["name", "values", "labels", "x_values", "color", "line_style", "marker_style"]
    },
    {
      "id": "REQ-RENDER-005",
      "description": "OutputTarget enum MUST support all required output formats",
      "targets": ["WEB_JSON", "WEB_HTML", "PNG", "SVG", "PDF", "PPTX_IMAGE", "PPTX_NATIVE"]
    }
  ],
  "contract_hierarchy": {
    "base": "RenderSpec",
    "children": [
      {
        "class": "ChartSpec",
        "purpose": "All chart/plot visualizations",
        "chart_types": ["line", "bar", "scatter", "box", "histogram", "heatmap", "pie", "interaction_plot", "main_effects"]
      },
      {
        "class": "TableSpec",
        "purpose": "Tabular data rendering",
        "use_cases": ["DAT data preview", "PPTX tables", "SOV ANOVA tables"]
      },
      {
        "class": "TextSpec",
        "purpose": "Text/label rendering",
        "types": ["title", "subtitle", "label", "annotation", "paragraph"]
      },
      {
        "class": "ImageSpec",
        "purpose": "Image embedding",
        "sources": ["source_path", "source_url", "source_base64"]
      },
      {
        "class": "CompositeSpec",
        "purpose": "Multi-panel layouts",
        "layouts": ["horizontal", "vertical", "grid"]
      }
    ]
  },
  "styling_hierarchy": {
    "root": "RenderStyle",
    "components": [
      "ColorPalette (enum)",
      "FontConfig",
      "GridConfig",
      "AxisConfig",
      "LegendConfig"
    ],
    "defaults": {
      "background_color": "#FFFFFF",
      "foreground_color": "#333333",
      "title_font_size": 14.0,
      "label_font_size": 11.0,
      "grid_alpha": 0.5
    }
  },
  "validation_rules": [
    "ChartSpec with PIE/DONUT type MUST have pie_data or series",
    "ChartSpec with HEATMAP/CONTOUR type MUST have heatmap_data",
    "ImageSpec MUST have exactly one of source_path, source_url, or source_base64",
    "Custom colors MUST be valid hex codes (#RRGGBB)"
  ],
  "cross_tool_usage": {
    "DAT": "Uses TableSpec for data previews",
    "SOV": "Uses ChartSpec for ANOVA visualizations (box plots, interaction plots)",
    "PPTX": "Consumes all spec types for slide population"
  },
  "examples": {
    "simple_line_chart": {
      "spec_type": "ChartSpec",
      "chart_type": "LINE",
      "series": [
        {"name": "Revenue", "values": [100, 150, 200], "labels": ["Q1", "Q2", "Q3"]}
      ]
    },
    "styled_table": {
      "spec_type": "TableSpec",
      "data": {
        "headers": ["Metric", "Value"],
        "rows": [["Mean", "42.5"], ["Std Dev", "3.2"]]
      },
      "header_background": "#4472C4"
    }
  },
  "references": [
    "ADR-0028_Unified-Rendering-Engine: WHY we need unified rendering",
    "shared/contracts/core/rendering.py: Tier-0 contracts (source of truth)",
    "SPEC-0032_Rendering-Engine-Architecture: HOW the engine processes specs",
    "SPEC-0033_Output-Target-Adapters: WHERE rendering outputs go"
  ]
}
