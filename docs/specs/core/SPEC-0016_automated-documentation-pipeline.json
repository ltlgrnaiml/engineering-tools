{
  "schema_type": "spec",
  "id": "SPEC-0016_automated-documentation-pipeline",
  "title": "Automated Documentation Pipeline Specification",
  "version": "2025.12.001",
  "status": "active",
  "implements": "ADR-0035",
  "date": "2025-12-28",
  "scope": "core",
  "summary": "Technical specification for automated documentation generation: Pydantic → JSON Schema, FastAPI → OpenAPI, docstrings → mkdocstrings, commits → CHANGELOG, ADR JSON → ADR_INDEX.md.",
  "pipeline_components": {
    "json_schema_generation": {
      "source": "shared/contracts/**/*.py",
      "tool": "tools/gen_json_schema.py",
      "output": "docs/schemas/*.json",
      "trigger": "CI on every commit; pre-commit optional",
      "implementation": {
        "script": "tools/gen_json_schema.py",
        "command": "python tools/gen_json_schema.py --output docs/schemas/",
        "dependencies": [
          "pydantic"
        ],
        "validation": "CI regenerates and compares to committed; fails on diff"
      }
    },
    "openapi_generation": {
      "source": "FastAPI app definitions",
      "tool": "FastAPI auto-generation",
      "output": "docs/api/openapi.json",
      "trigger": "CI extracts from running app",
      "implementation": {
        "endpoint": "GET /openapi.json",
        "command": "curl http://localhost:8000/openapi.json > docs/api/openapi.json",
        "validation": "CI compares live OpenAPI to committed; fails on diff"
      }
    },
    "api_reference_docs": {
      "source": "Python docstrings (Google-style)",
      "tool": "mkdocstrings",
      "output": "docs/reference/",
      "trigger": "mkdocs build",
      "implementation": {
        "plugin": "mkdocstrings[python]",
        "config_location": "mkdocs.yml",
        "options": {
          "docstring_style": "google",
          "show_source": true,
          "show_signature_annotations": true,
          "members_order": "source",
          "separate_signature": true
        },
        "usage_in_markdown": "::: shared.contracts.core.dataset.DataSetManifest"
      }
    },
    "changelog_generation": {
      "source": "Git commit history",
      "tool": "git-cliff",
      "output": "CHANGELOG.md",
      "trigger": "CI on release; manual for pre-release",
      "implementation": {
        "config_file": "cliff.toml",
        "command": "git-cliff --output CHANGELOG.md",
        "commit_parsers": [
          {
            "message": "^feat",
            "group": "Features"
          },
          {
            "message": "^fix",
            "group": "Bug Fixes"
          },
          {
            "message": "^docs",
            "group": "Documentation"
          },
          {
            "message": "^refactor",
            "group": "Refactoring"
          },
          {
            "message": "^test",
            "group": "Testing"
          },
          {
            "message": "^chore",
            "group": "Miscellaneous"
          }
        ]
      }
    },
    "adr_index_generation": {
      "source": ".adrs/**/*.json",
      "tool": "tools/gen_adr_index.py",
      "output": ".adrs/ADR_INDEX.md",
      "trigger": "CI on commits touching .adrs/",
      "implementation": {
        "script": "tools/gen_adr_index.py",
        "command": "python tools/gen_adr_index.py --output .adrs/ADR_INDEX.md",
        "validation": "CI regenerates and compares; fails on diff"
      }
    }
  },
  "mkdocs_configuration": {
    "file": "mkdocs.yml",
    "required_plugins": [
      "mkdocstrings[python]",
      "mkdocs-material"
    ],
    "mkdocstrings_config": {
      "handlers": {
        "python": {
          "options": {
            "docstring_style": "google",
            "show_source": true,
            "show_signature_annotations": true
          }
        }
      }
    }
  },
  "git_cliff_configuration": {
    "file": "cliff.toml",
    "template": "[package]\nname = \"engineering-tools\"\n\n[changelog]\nheader = \"# Changelog\\n\\n\"\nbody = \"{% for group, commits in commits | group_by(attribute='group') %}\\n## {{ group | upper_first }}\\n{% for commit in commits %}\\n- {{ commit.message }}{% endfor %}\\n{% endfor %}\"\ntrim = true\n\n[git]\nconventional_commits = true\nfilter_unconventional = true\ncommit_parsers = [\n  { message = '^feat', group = 'Features' },\n  { message = '^fix', group = 'Bug Fixes' },\n  { message = '^docs', group = 'Documentation' },\n  { message = '^refactor', group = 'Refactoring' },\n  { message = '^test', group = 'Testing' },\n  { message = '^chore', group = 'Miscellaneous' },\n]"
  },
  "ci_integration": {
    "pr_checks": [
      "Regenerate JSON Schema; compare to committed",
      "Regenerate ADR_INDEX.md; compare to committed",
      "Build mkdocs; verify no errors",
      "Verify OpenAPI matches live app"
    ],
    "main_merge": [
      "Generate CHANGELOG from commits",
      "Deploy docs to GitHub Pages"
    ]
  },
  "manual_documentation": {
    "allowed_for": [
      "README.md - Project overview",
      "docs/guides/ - Tutorials and how-to guides",
      "docs/index.md - Documentation homepage"
    ],
    "not_allowed_for": [
      "API reference (auto-generated from docstrings)",
      "JSON Schema (auto-generated from Pydantic)",
      "OpenAPI spec (auto-generated from FastAPI)",
      "CHANGELOG (auto-generated from commits)",
      "ADR_INDEX.md (auto-generated from ADR JSON)"
    ]
  },
  "requirements": [
    {
      "id": "REQ-DOC-001",
      "description": "JSON Schema MUST be auto-generated from Pydantic models"
    },
    {
      "id": "REQ-DOC-002",
      "description": "OpenAPI spec MUST be auto-generated from FastAPI"
    },
    {
      "id": "REQ-DOC-003",
      "description": "API reference MUST be auto-generated via mkdocstrings"
    },
    {
      "id": "REQ-DOC-004",
      "description": "CHANGELOG MUST be auto-generated from Conventional Commits"
    },
    {
      "id": "REQ-DOC-005",
      "description": "ADR_INDEX.md MUST be auto-generated from ADR JSON files"
    },
    {
      "id": "REQ-DOC-006",
      "description": "CI MUST fail if generated docs differ from committed"
    }
  ],
  "validation_commands": {
    "check_json_schema": "python tools/gen_json_schema.py --check",
    "check_adr_index": "python tools/gen_adr_index.py --check",
    "build_docs": "mkdocs build --strict",
    "generate_changelog": "git-cliff --output CHANGELOG.md"
  },
  "references": [
    "ADR-0034_Automated-Documentation-Pipeline",
    "mkdocstrings: https://mkdocstrings.github.io/",
    "git-cliff: https://git-cliff.org/",
    "mkdocs.yml",
    "tools/gen_json_schema.py",
    "tools/gen_adr_index.py"
  ],
  "tags": [
    "documentation",
    "automation",
    "mkdocs",
    "openapi",
    "changelog",
    "specification"
  ]
}