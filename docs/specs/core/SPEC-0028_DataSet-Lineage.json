{
  "schema_type": "spec",
  "id": "SPEC-0028_DataSet-Lineage",
  "title": "DataSet Lineage Tracking Specification",
  "version": "0.1.0",
  "status": "draft",
  "date": "2025-12-27",
  "author": "Mycahya Eggleston",
  "implements_adr": [
    "ADR-0025_DataSet-Lineage-Tracking"
  ],
  "tier_0_contracts": [
    {
      "module": "shared.contracts.core.dataset",
      "classes": ["DataSetManifest", "DataSetRef", "ColumnMeta", "LineageRecord"]
    }
  ],
  "purpose": "Define how datasets track their lineage across tools. When DAT produces a dataset consumed by SOV, or SOV results feed into PPTX, the lineage chain is preserved for auditability and reproducibility.",
  "scope": "core",
  "requirements": [
    {
      "id": "REQ-LINEAGE-001",
      "description": "Every DataSet MUST have a unique dataset_id",
      "format": "SHA-256 hash of source + schema + timestamp",
      "reference": "ADR-0004"
    },
    {
      "id": "REQ-LINEAGE-002",
      "description": "DataSet manifests MUST include parent_refs for lineage",
      "implementation": "DataSetRef list in manifest pointing to upstream datasets"
    },
    {
      "id": "REQ-LINEAGE-003",
      "description": "Column-level lineage MUST track transformations",
      "implementation": "ColumnMeta.source_columns field"
    },
    {
      "id": "REQ-LINEAGE-004",
      "description": "Cross-tool handoffs MUST preserve lineage chain",
      "flows": ["DAT → SOV", "DAT → PPTX", "SOV → PPTX"]
    },
    {
      "id": "REQ-LINEAGE-005",
      "description": "Lineage queries MUST support forward and backward traversal",
      "implementation": "get_upstream(dataset_id), get_downstream(dataset_id)"
    }
  ],
  "dataset_manifest": {
    "required_fields": [
      "dataset_id",
      "created_at",
      "created_by_tool",
      "schema_version",
      "columns",
      "row_count",
      "parent_refs"
    ],
    "optional_fields": [
      "description",
      "tags",
      "quality_metrics",
      "sample_data"
    ]
  },
  "lineage_graph": {
    "nodes": "DataSet manifests",
    "edges": "parent_refs → child relationships",
    "traversal": ["Breadth-first for impact analysis", "Depth-first for root cause"],
    "visualization": "DAG rendering in DevTools"
  },
  "cross_tool_flows": {
    "DAT_to_SOV": {
      "source": "DAT Export stage produces Parquet + manifest",
      "handoff": "SOV Load stage reads manifest, adds as parent_ref",
      "lineage": "SOV results include DAT dataset_id in lineage"
    },
    "DAT_to_PPTX": {
      "source": "DAT Export stage produces Parquet + manifest",
      "handoff": "PPTX Data stage reads manifest, binds to shapes",
      "lineage": "PPTX generation includes DAT dataset_id in audit trail"
    },
    "SOV_to_PPTX": {
      "source": "SOV Analyze stage produces results + manifest",
      "handoff": "PPTX binds SOV visualization specs to chart shapes",
      "lineage": "PPTX includes SOV analysis_id in audit trail"
    }
  },
  "references": [
    "ADR-0025_DataSet-Lineage-Tracking: WHY we track lineage",
    "ADR-0004_Deterministic-Content-Addressed-IDs: HOW datasets are identified",
    "shared/contracts/core/dataset.py: Tier-0 contracts"
  ]
}
