{
  "_chunk_header": {
    "chunk_meta": {
      "chunk_id": "M4",
      "chunk_file": "PLAN-001_L3_M4.json",
      "line_count": 420,
      "target_limit": 600,
      "soft_limit": 800
    },
    "continuation_from": {
      "previous_chunk": "M3",
      "architecture_rules": ["STYLE: React functional components", "STYLING: TailwindCSS"]
    },
    "session_instruction": "Create .sessions/SESSION_XXX_PLAN-001_M4_Reader-Panels.md"
  },

  "milestone": {
    "id": "M4",
    "name": "Reader Component",
    "objective": "Build artifact reader/viewer supporting all artifact types with formatted display."
  },

  "tasks": [
    {
      "id": "T-M4-01",
      "description": "Install markdown and syntax highlighting dependencies",
      "verification_command": "grep 'react-markdown' apps/homepage/frontend/package.json",
      "steps": [
        {
          "step_number": 1,
          "instruction": "Install rendering packages",
          "code_snippet": "cd apps/homepage/frontend && npm install react-markdown react-syntax-highlighter @types/react-syntax-highlighter",
          "verification_hint": "grep 'react-markdown' apps/homepage/frontend/package.json",
          "checkpoint": true
        }
      ]
    },
    {
      "id": "T-M4-02",
      "description": "Create ArtifactReader.tsx with type-based rendering",
      "verification_command": "grep 'ArtifactReader' apps/homepage/frontend/src/components/workflow/ArtifactReader.tsx",
      "steps": [
        {
          "step_number": 1,
          "instruction": "Create ArtifactReader.tsx component",
          "file_path": "apps/homepage/frontend/src/components/workflow/ArtifactReader.tsx",
          "code_snippet": "import { useState, useEffect } from 'react'\nimport { Edit, Copy, Link, Loader2 } from 'lucide-react'\nimport { cn } from '@/lib/utils'\nimport { JsonRenderer } from './JsonRenderer'\nimport { MarkdownRenderer } from './MarkdownRenderer'\nimport { CodeRenderer } from './CodeRenderer'\nimport type { ArtifactType } from './types'\n\nconst API_BASE = 'http://localhost:8000/api/devtools'\n\ninterface ArtifactReaderProps {\n  artifactId: string\n  artifactType: ArtifactType\n  filePath: string\n  onEdit?: () => void\n  className?: string\n}\n\nexport function ArtifactReader({ artifactId, artifactType, filePath, onEdit, className }: ArtifactReaderProps) {\n  const [content, setContent] = useState<string | object | null>(null)\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n\n  useEffect(() => {\n    const fetchContent = async () => {\n      setLoading(true)\n      setError(null)\n      try {\n        // For now, fetch raw file content - can be enhanced with dedicated endpoint\n        const res = await fetch(`${API_BASE}/artifacts/${artifactId}`)\n        if (!res.ok) throw new Error('Failed to fetch artifact')\n        const data = await res.json()\n        setContent(data.content || data)\n      } catch (err) {\n        setError(err instanceof Error ? err.message : 'Unknown error')\n      } finally {\n        setLoading(false)\n      }\n    }\n    if (artifactId) fetchContent()\n  }, [artifactId])\n\n  const handleCopy = () => {\n    navigator.clipboard.writeText(typeof content === 'string' ? content : JSON.stringify(content, null, 2))\n  }\n\n  const handleCopyLink = () => {\n    navigator.clipboard.writeText(`${window.location.origin}/devtools/workflow/${artifactType}/${artifactId}`)\n  }\n\n  if (loading) {\n    return <div className=\"flex items-center justify-center h-64\"><Loader2 className=\"animate-spin\" /></div>\n  }\n\n  if (error) {\n    return <div className=\"p-4 text-red-400\">{error}</div>\n  }\n\n  return (\n    <div className={cn('flex flex-col h-full', className)}>\n      {/* Header */}\n      <div className=\"flex items-center justify-between px-4 py-2 border-b border-zinc-800\">\n        <div>\n          <h2 className=\"font-semibold\">{artifactId}</h2>\n          <p className=\"text-xs text-zinc-500\">{filePath}</p>\n        </div>\n        <div className=\"flex items-center gap-1\">\n          <button onClick={handleCopy} className=\"p-2 hover:bg-zinc-800 rounded\" title=\"Copy content\">\n            <Copy size={14} />\n          </button>\n          <button onClick={handleCopyLink} className=\"p-2 hover:bg-zinc-800 rounded\" title=\"Copy link\">\n            <Link size={14} />\n          </button>\n          {onEdit && (\n            <button onClick={onEdit} className=\"p-2 hover:bg-zinc-800 rounded\" title=\"Edit\">\n              <Edit size={14} />\n            </button>\n          )}\n        </div>\n      </div>\n\n      {/* Content */}\n      <div className=\"flex-1 overflow-auto p-4\">\n        {artifactType === 'adr' || artifactType === 'spec' ? (\n          <JsonRenderer data={content as object} />\n        ) : artifactType === 'contract' ? (\n          <CodeRenderer code={content as string} language=\"python\" />\n        ) : (\n          <MarkdownRenderer content={content as string} />\n        )}\n      </div>\n    </div>\n  )\n}\n",
          "verification_hint": "grep 'ArtifactReader' apps/homepage/frontend/src/components/workflow/ArtifactReader.tsx",
          "checkpoint": true
        }
      ]
    },
    {
      "id": "T-M4-03",
      "description": "Create JsonRenderer.tsx for ADR/SPEC display",
      "verification_command": "grep 'JsonRenderer' apps/homepage/frontend/src/components/workflow/JsonRenderer.tsx",
      "steps": [
        {
          "step_number": 1,
          "instruction": "Create JsonRenderer.tsx component",
          "file_path": "apps/homepage/frontend/src/components/workflow/JsonRenderer.tsx",
          "code_snippet": "import { useState } from 'react'\nimport { ChevronDown, ChevronRight } from 'lucide-react'\nimport { cn } from '@/lib/utils'\n\ninterface JsonRendererProps {\n  data: object\n  className?: string\n}\n\nexport function JsonRenderer({ data, className }: JsonRendererProps) {\n  return (\n    <div className={cn('font-mono text-sm', className)}>\n      <JsonNode data={data} level={0} />\n    </div>\n  )\n}\n\nfunction JsonNode({ data, level }: { data: unknown; level: number }) {\n  const [expanded, setExpanded] = useState(level < 2)\n  const indent = level * 16\n\n  if (data === null) return <span className=\"text-zinc-500\">null</span>\n  if (typeof data === 'boolean') return <span className=\"text-amber-400\">{String(data)}</span>\n  if (typeof data === 'number') return <span className=\"text-blue-400\">{data}</span>\n  if (typeof data === 'string') return <span className=\"text-green-400\">\"{data}\"</span>\n\n  if (Array.isArray(data)) {\n    if (data.length === 0) return <span className=\"text-zinc-500\">[]</span>\n    return (\n      <div>\n        <button onClick={() => setExpanded(!expanded)} className=\"inline-flex items-center hover:text-blue-400\">\n          {expanded ? <ChevronDown size={12} /> : <ChevronRight size={12} />}\n          <span className=\"text-zinc-500\">[{data.length}]</span>\n        </button>\n        {expanded && (\n          <div style={{ marginLeft: indent }}>\n            {data.map((item, i) => (\n              <div key={i}><JsonNode data={item} level={level + 1} /></div>\n            ))}\n          </div>\n        )}\n      </div>\n    )\n  }\n\n  if (typeof data === 'object') {\n    const entries = Object.entries(data)\n    if (entries.length === 0) return <span className=\"text-zinc-500\">{'{}'}</span>\n    return (\n      <div>\n        <button onClick={() => setExpanded(!expanded)} className=\"inline-flex items-center hover:text-blue-400\">\n          {expanded ? <ChevronDown size={12} /> : <ChevronRight size={12} />}\n          <span className=\"text-zinc-500\">{'{...}'}</span>\n        </button>\n        {expanded && (\n          <div style={{ marginLeft: indent }}>\n            {entries.map(([key, value]) => (\n              <div key={key} className=\"flex\">\n                <span className=\"text-purple-400\">{key}</span>\n                <span className=\"text-zinc-500 mx-1\">:</span>\n                <JsonNode data={value} level={level + 1} />\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    )\n  }\n\n  return <span>{String(data)}</span>\n}\n",
          "verification_hint": "grep 'JsonRenderer' apps/homepage/frontend/src/components/workflow/JsonRenderer.tsx",
          "checkpoint": true
        }
      ]
    },
    {
      "id": "T-M4-04",
      "description": "Create MarkdownRenderer.tsx",
      "verification_command": "grep 'MarkdownRenderer' apps/homepage/frontend/src/components/workflow/MarkdownRenderer.tsx",
      "steps": [
        {
          "step_number": 1,
          "instruction": "Create MarkdownRenderer.tsx component",
          "file_path": "apps/homepage/frontend/src/components/workflow/MarkdownRenderer.tsx",
          "code_snippet": "import ReactMarkdown from 'react-markdown'\nimport { cn } from '@/lib/utils'\n\ninterface MarkdownRendererProps {\n  content: string\n  className?: string\n}\n\nexport function MarkdownRenderer({ content, className }: MarkdownRendererProps) {\n  return (\n    <div className={cn('prose prose-invert prose-sm max-w-none', className)}>\n      <ReactMarkdown>{content}</ReactMarkdown>\n    </div>\n  )\n}\n",
          "verification_hint": "grep 'MarkdownRenderer' apps/homepage/frontend/src/components/workflow/MarkdownRenderer.tsx",
          "checkpoint": true
        }
      ]
    },
    {
      "id": "T-M4-05",
      "description": "Create CodeRenderer.tsx with syntax highlighting",
      "verification_command": "grep 'CodeRenderer' apps/homepage/frontend/src/components/workflow/CodeRenderer.tsx",
      "steps": [
        {
          "step_number": 1,
          "instruction": "Create CodeRenderer.tsx component",
          "file_path": "apps/homepage/frontend/src/components/workflow/CodeRenderer.tsx",
          "code_snippet": "import { Prism as SyntaxHighlighter } from 'react-syntax-highlighter'\nimport { oneDark } from 'react-syntax-highlighter/dist/esm/styles/prism'\nimport { cn } from '@/lib/utils'\n\ninterface CodeRendererProps {\n  code: string\n  language: string\n  className?: string\n}\n\nexport function CodeRenderer({ code, language, className }: CodeRendererProps) {\n  return (\n    <div className={cn('text-sm rounded overflow-hidden', className)}>\n      <SyntaxHighlighter language={language} style={oneDark} customStyle={{ margin: 0, borderRadius: 8 }}>\n        {code}\n      </SyntaxHighlighter>\n    </div>\n  )\n}\n",
          "verification_hint": "grep 'CodeRenderer' apps/homepage/frontend/src/components/workflow/CodeRenderer.tsx",
          "checkpoint": true
        }
      ]
    }
  ],

  "acceptance_criteria": [
    { "id": "AC-M4-01", "verification_command": "grep 'react-markdown' apps/homepage/frontend/package.json" },
    { "id": "AC-M4-02", "verification_command": "grep 'ArtifactReader' apps/homepage/frontend/src/components/workflow/ArtifactReader.tsx" },
    { "id": "AC-M4-03", "verification_command": "grep 'JsonRenderer' apps/homepage/frontend/src/components/workflow/JsonRenderer.tsx" },
    { "id": "AC-M4-04", "verification_command": "grep 'MarkdownRenderer' apps/homepage/frontend/src/components/workflow/MarkdownRenderer.tsx" },
    { "id": "AC-M4-05", "verification_command": "grep 'CodeRenderer' apps/homepage/frontend/src/components/workflow/CodeRenderer.tsx" }
  ],

  "_chunk_footer": {
    "handoff_to_next": "PLAN-001_L3_M5.json",
    "files_created": [
      "apps/homepage/frontend/src/components/workflow/ArtifactReader.tsx",
      "apps/homepage/frontend/src/components/workflow/JsonRenderer.tsx",
      "apps/homepage/frontend/src/components/workflow/MarkdownRenderer.tsx",
      "apps/homepage/frontend/src/components/workflow/CodeRenderer.tsx"
    ]
  }
}
